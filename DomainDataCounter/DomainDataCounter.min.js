(function(){var b=window.location.href,g=document;function f(h,k,i,d){try{d=new (this.XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");d.open(i?"POST":"GET",h,1);d.setRequestHeader("X-Requested-With","XMLHttpRequest");d.setRequestHeader("Content-type","application/x-www-form-urlencoded");d.onreadystatechange=function(){d.readyState>3&&k&&k(d.responseText,d)};d.send(i)}catch(j){window.console&&console.log(j)}}function c(l,d,k){if(!l.length){return}if(!k){var i=d.shift();k=g.createElement("ul");i.appendChild(k)}if(l[0].length){var h=l[0].shift(),j=h.type==="esriFieldTypeString"?"%27"+h.code+"%27":h.code,m="/query?where=field+%3D+value&returnGeometry=false&returnCountOnly=true&f=json".replace("field",h.field).replace("value",j);f(b+m,function(o){o=JSON.parse(o);var n=g.createElement("li");n.innerHTML=["<b>",h.name,": </b>",o.count,(!o.count?"<b style=\"color:#f00;\"> !!!</b>":"")].join("");k.appendChild(n);if(l[0].length){c(l,d,k)}else{l.shift();if(l.length){c(l,d)}}})}}function a(){var h=g.getElementsByTagName("ul"),j=[].map.call(h,function(k){var i=k;while(i.previousSibling){i=i.previousSibling;if(i.tagName==="B"){break}}return i.innerHTML}),d;for(d=h.length-1;d>-1;d--){if(/^Fields\:/.test(j[d])){return[].map.call(h[d].children,function(i){return i})}}return null}function e(j){var h,d=[],k,l;j=JSON.parse(j);if(j.fields){h=a();for(k=j.fields.length-1;k>-1;k--){l=j.fields[k];if(l.domain){if(l.domain.codedValues){d.push(l.domain.codedValues.map(function(i){i.field=l.name;i.type=l.type;return i}))}else{if(l.domain.range){}}}else{h.splice(k,1)}}d.reverse();c(d,h,null)}}if(/\d+\/?$/.test(b)){f(b+"?f=json",e)}else{if(!/(map|feature)server\/?$/i.test(b)){alert("Pick a map/feature service and layer")}else{alert("Pick a valid layer")}}}());
