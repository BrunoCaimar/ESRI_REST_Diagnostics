(function(){var a=window.location.href.split("?")[0],g=/\/query\/?$/i;function f(j,m,k,i){try{i=new (window.XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");i.open(k?"POST":"GET",j,1);i.setRequestHeader("X-Requested-With","XMLHttpRequest");i.setRequestHeader("Content-type","application/x-www-form-urlencoded");i.onreadystatechange=function(){i.readyState>3&&m&&m(JSON.parse(i.responseText),i)};i.send(k)}catch(l){window.console&&console.log(l)}}function c(i,k,m){var l=document.createElement(i),j;for(j in k){l.setAttribute(j,k[j])}if(m){l.innerHTML=m}return l}function h(j,k){var i=c("select",{name:k.name});j.forEach(function(m){var l=c("option",{value:m.name},m.alias+" ("+m.name+")");i.appendChild(l)});i.value=j[0].name;k.parentNode.replaceChild(i,k)}function e(i){return[].map.call(document.getElementsByTagName(i),function(j){return j})}function b(){return e("INPUT").concat(e("TEXTAREA"))}function d(j){var i={where:"1=1",returnDistinctValues:"true",returnGeometry:"false"};j.forEach(function(k){if(i.hasOwnProperty(k.name)){if(k.type&&k.type==="radio"&&i[k.name]===k.value){k.checked=true}else{k.value=i[k.name]}}else{if(k.name==="outFields"){f(a.replace(g,"?f=json"),function(l){h(l.fields.filter(function(m){return m.type.substr(13).toLowerCase()!=="geometry"}),k)})}}})}if(g.test(a)){d(b())}else{if(!/(map|feature)server\/\d+\/?$/i.test(a)){alert("Go to the query page to use this tool.")}else{alert("Pick a valid layer")}}}());