<!DOCTYPE HTML>
<html>
<head>
	<title>ESRI REST Diagnoatics</title>
</head>
<body>
	<h1>ESRI Rest Diagnostics</h1>
	<p>This page provides links to tools that can be used to inspect and pull out data out of ESRI's REST endpoints.</p>
	<ul>
		<li><a href='javascript:(function(){var url="http://js.arcgis.com/3.8/",scr1;function loadMe(){require(["dojo/ready","dojo/dom-construct","dojo/on","esri/request","esri/tasks/query","esri/tasks/QueryTask"],function(ready,domConstruct,on,esriRequest,Query,QueryTask){var qt=new QueryTask(window.location.href),queryMe=function(tbody,f,i){var q=new Query(),timeCheck;if(i<f.length){q.returnGeometry=false;q.outFields=[];q.where=["NOT",f[i].name,"IS NULL"].join(" ");timeCheck=Date.now();qt.executeForCount(q).then(function(resp){var tr=domConstruct.create("tr",{},tbody),results=[f[i].name,f[i].alias,f[i].type,resp,Date.now()-timeCheck],x;for(x=0;x<5;x++){domConstruct.create("td",{innerHTML:results[x]},tr);}queryMe(tbody,f,++i);});}};ready(function(){var div=domConstruct.create("div",{style:"position:fixed;bottom:5px;top:50%;right:5px;width:50%;border:1px solid green;padding:5px;background:#fff;overflow:auto;text-align:center;"},document.body),closer=domConstruct.create("button",{type:"button",innerHTML:"Close",style:"float: right;"},div);on(closer,"click",function(){domConstruct.destroy(div);});esriRequest({url:qt.url,handleAs:"json",content:{f:"json"}}).then(function(response){if(response.fields){var tbl=domConstruct.create("table",{style:"position:relative;margin:0 auto;"},div),tbdy=domConstruct.create("tbody",{},tbl);domConstruct.create("tr",{innerHTML:"<th>"+["Field Name","Alias","Type","Records with values","Return Time (ms)"].join("</th><th>")+"</th>"},tbdy);queryMe(tbdy,response.fields,0);}},function(err){alert(err.toString());});});});}function scriptLoaded(url){var scripts=document.getElementsByTagName("script"),i;for(i=scripts.length-1;i>-1;i--){if(scripts[i].src===url){return true;}}return false;}if(!scriptLoaded(url)){scr1=document.createElement("script");scr1.setAttribute("type","text/javascript");scr1.onload=loadMe;scr1.setAttribute("src",url);document.body.appendChild(scr1);}else{loadMe();}}());' title='Query Field Tester'>Query Field Tester</a></li>
		<li><a href='javascript:(function(){var url="http://js.arcgis.com/3.8/",scr1,colorhash={};function getFullLink(link){var newLink="",wl=window.location;if(link.indexOf(wl.protocol)===0){return link;}newLink+=wl.protocol+"//";if(link.indexOf(wl.hostname)===0){return newLink+link;}newLink+=wl.hostname;if(link.indexOf(wl.pathname)===0){return newLink+link;}return newLink+wl.pathname+link;}function getColor(item){if(colorhash[item]){return colorhash[item];}colorhash[item]="#"+(0x1000000+(Math.random())*0xffffff).toString(16).substr(1,6);return colorhash[item];}function getCompColor(item){var col=colorhash[item],newcol="",coltbl="fedcba98".indexOf(col.substr(1,1))>-1?{f:"7",e:"6",d:"5",c:"4",b:"3",a:"2","9":"1","8":"0","7":"0","6":"0","5":"0","4":"0","3":"0","2":"0","1":"0","0":"0"}:{f:"f",e:"f",d:"f",c:"f",b:"f",a:"f","9":"f","8":"f","7":"f","6":"e","5":"d","4":"c","3":"b","2":"a","1":"9","0":"8"},c;for(c=0;c<col.length;c++){newcol+=c%2===1?coltbl[col.substr(c,1)]:col.substr(c,1);}return newcol;}function loadMe(){require(["dojo/query","dojo/dom-construct","dojo/dom-attr","esri/request"],function(dojoQuery,domConstruct,domAttr,esriRequest){var review=function(list,index){var jsonUrl,node;if(index<list.length){node=list[index];jsonUrl=domAttr.get(node,"href");jsonUrl=getFullLink(jsonUrl);esriRequest({url:jsonUrl,handleAs:"json",content:{f:"json"}}).then(function(response){var wkid,sp;if(!response.spatialReference){return;}sp=response.spatialReference;wkid=sp.latestWkid||sp.wkid||null;if(wkid===null){domConstruct.create("span",{innerHTML:"&nbsp;No valid wkid available &nbsp;"},node,"after");}else{domConstruct.create("a",{href:"http://spatialreference.org/ref/?search="+wkid,innerHTML:"WKID: "+wkid,style:"background:"+getColor(wkid)+";color:"+getCompColor(wkid)+";"},node,"after");}domConstruct.create("span",{innerHTML:"&nbsp;"+(response.singleFusedMapCache?"tiled":"dynamic")+"&nbsp;"},node,"after");review(list,++index);});}},linkList=dojoQuery("a[href$=\"MapServer\"]");review(linkList,0);});}function scriptLoaded(url){var scripts=document.getElementsByTagName("script"),i;for(i=scripts.length-1;i>-1;i--){if(scripts[i].src===url){return true;}}return false;}if(!scriptLoaded(url)){scr1=document.createElement("script");scr1.setAttribute("type","text/javascript");scr1.onload=loadMe;scr1.setAttribute("src",url);document.body.appendChild(scr1);}else{loadMe();}}());' title='MapService Reviewer v 0.1'>MapService Data Display v 0.1</a></li>
		<li><a href='javascript:(function(){var url="http://js.arcgis.com/3.8/",scr1;function loadMe(){require(["dojo/ready","dojo/dom-construct","dojo/on","esri/request","dojo/_base/lang","dojo/_base/array"],function(ready,domConstruct,on,esriRequest,lang,array){function getFinalVal(fields,response){var result=response.hasOwnProperty(fields[0])?response[fields[0]]:null;if(result!=null&&fields.length>1){if(result instanceof Array){return array.map(result,function(item){return getFinalVal(fields.slice(1),item);});}return getFinalVal(fields.slice(1),result);}return result;}function printResult(field,result,url,node){domConstruct.create("a",{innerHTML:[field,result].join(": "),href:url},node);domConstruct.create("br", {}, node);}function checkAndPrint(searchFor,field,result,url,node){if(isNaN(searchFor)){if(searchFor.test(result)){printResult(field,result,url,node);}}else if(searchFor===result){printResult(field,result,url,node);}}function responseSearch(url,resp,fieldList,searchFor,node){array.forEach(fieldList,function(field){var result=getFinalVal(field.split("."),resp);if(result==null){return;}if(result instanceof Array){array.forEach(result,function(item){checkAndPrint(searchFor,field,item,url,node);});}else{checkAndPrint(searchFor,field,result,url,node);}});}function mapLayerSearch(url,node,searchFor){esriRequest({url:url,handleAs:"json",content:{f:"json"}}).then(function(resp){responseSearch(url,resp,["name","description","displayField","fields.name","fields.alias"],searchFor,node);});}function mapServiceSearch(url,node,searchFor){esriRequest({url:url,handleAs:"json",content:{f:"json"}}).then(function(resp){responseSearch(url,resp,["mapName","layers.name","documentInfo.Title","documentInfo.Comments","documentInfo.Subject","documentInfo.Category","documentInfo.Keywords"],searchFor,node);if(resp.layers&&resp.layers.length){array.forEach(resp.layers,function(layer){mapLayerSearch([url,layer.id].join("/"),node,searchFor);});}if(resp.tables&&resp.tables.length){array.forEach(resp.tables,function(table){mapLayerSearch([url,table.id].join("/"),node,searchFor);});}});}function folderSearch(url,node,searchFor){esriRequest({url:url,handleAs:"json",content:{f:"json"}}).then(function(resp){responseSearch(url,resp,["folder","service.name"],searchFor,node);if(resp.folders&&resp.folders.length){array.forEach(resp.folders,function(folder){folderSearch([url,folder].join("/"),node,searchFor);});}if(resp.services&&resp.services.length){array.forEach(resp.services,function(service){mapServiceSearch([url,service.name.replace(/\w+\//ig, ""),service.type].join("/"),node,searchFor);});}});}ready(function(){var div=domConstruct.create("div",{style:"position:fixed;bottom:5px;top:50%;right:5px;width:50%;border:1px solid #880;padding:5px;background:#fff;overflow:auto;text-align:center;"},document.body),searchFor;domConstruct.create("button",{type:"button",innerHTML:"Close",style:"float: right;",onclick:function(){domConstruct.destroy(div);}},div);searchFor=prompt("What would you like to search for?");if(/^\d*\.?\d+$/.test(searchFor)){searchFor=/\./.test(searchFor)?parseFloat(searchFor):parseInt(searchFor,10);}else{searchFor=new RegExp(searchFor);}url=window.location.href;if(/\/\d+\/?$/.test(url)){mapLayerSearch(url,div,searchFor);}else if(/\/\w+server\/?$/.test(url)){mapServiceSearch(url,div,searchFor);}else{folderSearch(url,div,searchFor);}});});}function scriptLoaded(url){var scripts=document.getElementsByTagName("script"),i;for(i=scripts.length-1;i>-1;i--){if(scripts[i].src===url){return true;}}return false;}if(!scriptLoaded(url)){scr1=document.createElement("script");scr1.setAttribute("type","text/javascript");scr1.onload=loadMe;scr1.setAttribute("src",url);document.body.appendChild(scr1);}else{loadMe();}}());' title='Rest Search v 0.1'>Rest Search v 0.1</a></li>
		<li><a href='javascript:(function(){var url="http://js.arcgis.com/3.8/",css=url+"js/esri/css/esri.css",d=document,style1,scr1;function loadMe(){require(["dojo/ready","dojo/dom-construct","dojo/query","dojo/json","esri/request","esri/toolbars/draw","esri/map","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ArcGISTiledMapServiceLayer"],function(ready,dC,dQ,JSON,esriRequest,Draw,Map,Dynamic,Tiled){ready(function(){var wl=window.location,url=wl.href.replace(wl.search,"").replace(/\/\d+\/query\/?$/i,""),geoBlank=dQ("textarea[name=\"geometry\"]"),geoSelect=dQ("select[name=\"geometryType\"]")[0];esriRequest({url:url,handleAs:"json",content:{f:"json"}}).then(function(resp){var div=dC.create("div",{style:"position:fixed;bottom:15%;top:15%;right:0;width:40%;border:1px solid #F88;padding:5px;background:#fff;overflow:auto;",innerHTML:"<button "+["id=\"btnpt\">Point","id=\"btnln\">Line","id=\"btnpg\">Polygon","id=\"btnex\">Extent"].join("</button><button ")+"</button><button id=\"closr\">Close</button><div id=\"map\" style=\"width:100%;\"></div>"},d.body),map=new Map("map",{}),layer=resp.singleFusedMapCache?new Tiled(url):new Dynamic(url),xlator={btnpt:Draw.POINT,btnln:Draw.POLYLINE,btnpg:Draw.POLYGON,btnex:Draw.EXTENT},draw;map.on("load",function(){draw=new Draw(map);dQ("button",div).on("click",function(evt){if(evt.target.id in xlator){draw.activate(xlator[evt.target.id]);}else{map.destroy();dC.destroy(div);}});draw.on("draw-end",function(drawn){var i,xlator={point:"esriGeometryPoint",multipoint:"esriGeometryMultipoint",polyline:"esriGeometryPolyline",polygon:"esriGeometryPolygon",extent:"esriGeometryEnvelope"};for(i=geoSelect.options.length-1;i>-1;i--){if(geoSelect.options[i].value===xlator[drawn.geometry.type]){geoSelect.selectedIndex=i;break;}}geoBlank.value=JSON.stringify(drawn.geometry.toJson());});});map.addLayer(layer);geoBlank=geoBlank&&geoBlank.length?geoBlank[0]:dC.create("textarea",{},div);});});});}function scriptLoaded(url){var scripts=d.getElementsByTagName("script"),i;for(i=scripts.length-1;i>-1;i--){if(scripts[i].src===url){return true;}}return false;}if(!scriptLoaded(url)){style1=d.createElement("link");style1.setAttribute("rel","stylesheet");style1.setAttribute("type","text/css");style1.href=css;d.head.appendChild(style1);scr1=d.createElement("script");scr1.setAttribute("type","text/javascript");scr1.onload=loadMe;scr1.setAttribute("src",url);d.body.appendChild(scr1);}else{loadMe();}}());' title='Geometry Helper'>Geometry Helper</a></li>
	</ul>
</body>
</html>