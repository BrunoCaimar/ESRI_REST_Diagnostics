<!DOCTYPE HTML>
<html>
<head>
	<title>ESRI REST Diagnoatics</title>
</head>
<body>
	<h1>ESRI Rest Diagnostics</h1>
	<p>This page provides links to tools that can be used to inspect and pull out data out of ArcGIS REST Services.</p>
	<ul>
		<li><a href='javascript:(function(){var url=window.location.href,d=document,node;function ajax(u,callback,data,x){try{x=new(this.XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");x.open(data?"POST":"GET",u,1);x.setRequestHeader("X-Requested-With","XMLHttpRequest");x.setRequestHeader("Content-type","application/x-www-form-urlencoded");x.onreadystatechange=function(){x.readyState>3&&callback&&callback(x.responseText,x);};x.send(data)}catch(e){window.console&&console.log(e);}}function queryMe(fs){if(!fs.length){return;}var f=fs.shift(),p="/query?where=not+field+is+null&returnGeometry=false&returnCountOnly=true&f=json".replace("field",f.name),tc=Date.now();ajax(url+p,function(r){r=JSON.parse(r);var tr=d.createElement("tr");tr.innerHTML="<td>"+[f.name,f.alias,f.type,r.count,Date.now()-tc].join("</td><td>")+"</td>";node.appendChild(tr);if(fs.length){queryMe(fs);}});}function onLoad(r){r=JSON.parse(r);if(r.fields){var div=d.createElement("div");div.setAttribute("style","position:fixed;bottom:5px;top:50%;right:5px;width:50%;border:1px solid #0F0;padding:5px;background:#fff;overflow:auto;text-align:center;");d.body.appendChild(div);var cb=d.createElement("button");cb.setAttribute("type","button");cb.setAttribute("style","float:right;");cb.onclick=function(){d.body.removeChild(div)};cb.innerHTML="close";div.appendChild(cb);var table=d.createElement("table");table.setAttribute("style","position:relative;margin:0 auto;");table.innerHTML="<thead><tr><th>"+["Field Name","Alias","Type","# values not null","Return Time (ms)"].join("</th><th>")+"</th></tr></thead>";div.appendChild(table);node=d.createElement("tbody");table.appendChild(node);queryMe(r.fields);}}if(/\d+\/?$/.test(url)){ajax(url+"?f=json",onLoad);}else{if(!/(map|feature)server\/?$/i.test(url)){alert("Pick a map/feature service and layer");}else{alert("Pick a valid layer");}}}());' title='Query Field Tester'>Query Field Tester</a></li>
		<li><a href='javascript:(function(){var d=document,tags=d.getElementsByTagName("a"),urls=[],cH={},i;function getFL(k){var nL="",wl=window.location;if(k.indexOf(wl.protocol)===0){return k;}nL+=wl.protocol+"//";if(k.indexOf(wl.hostname)===0){return nL+k;}nL+=wl.hostname;if(k.indexOf(wl.pathname)===0){return nL+k;}return nL+wl.pathname+k;}function getC(item){if(cH[item]){return cH[item];}cH[item]="#"+(0x1000000+(Math.random())*0xffffff).toString(16).substr(1,6);return cH[item];}function getCC(item){var col=cH[item],newcol="",mid=[col.substr(1,1),col.substr(3,1),col.substr(5,1)].sort()[1],coltbl="fedcba98".indexOf(mid)>-1?"0000000001234567":"89abcdefffffffff",c;for(c=0;c<col.length;c++){newcol+=c%2===1?coltbl[parseInt(col.substr(c,1),16)]:col.substr(c,1);}return newcol;}function srNode(sr){var n,val="&nbsp;No valid spatial reference available &nbsp;",el="span";if(sr){val=sr.latestWkid||sr.wkid||sr.latestWkt||sr.wkt||noval;if(sr.latestWkid||sr.wkid){el="a";}}n=d.createElement(el);if(el==="a"){n.setAttribute("href","http://spatialreference.org/ref/?search="+val);}n.setAttribute("style",["color:",getC(val),";background:",getCC(val),";"].join(""));n.innerHTML=val;return n;}function ajax(u,callback,data,x){try{x=new(this.XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");x.open(data?"POST":"GET",u,1);x.setRequestHeader("X-Requested-With","XMLHttpRequest");x.setRequestHeader("Content-type","application/x-www-form-urlencoded");x.onreadystatechange=function(){x.readyState>3&&callback&&callback(x.responseText,x);};x.send(data);}catch(e){window.console&&console.log(e);}}function queryMe(f){if(!f.length){return;}var data=f.shift();ajax(data.url+"?f=json",function(r){r=JSON.parse(r);var node=srNode(r.spatialReference),n2=d.createElement("b");n2.innerHTML=r.singleFusedMapCache?"tiled":"dynamic";data.link.parentNode.appendChild(node);data.link.parentNode.appendChild(n2);if(f.length){queryMe(f);}});}for(i=0;i<tags.length;i++){if(/(map|feature|image|mobile)server\/?$/i.test(tags[i].href)){urls.push({link:tags[i],url:getFL(tags[i].href)});}}if(urls&&urls.length){queryMe(urls);}else{alert("Pick a REST Service folder with services");}}());' title='Spatial Reference Comparison'>Spatial Reference Comparison</a></li>
		<li><a href='javascript:(function(){var d=document,tags=d.getElementsByTagName("a"),urls=[],i;function ajax(u,callback,data,x){try{x=new(this.XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");x.open(data?"POST":"GET",u,1);x.setRequestHeader("X-Requested-With","XMLHttpRequest");x.setRequestHeader("Content-type","application/x-www-form-urlencoded");x.onreadystatechange=function(){x.readyState>3&&callback&&callback(x.responseText,x);};x.send(data);}catch(e){window.console&&console.log(e);}}function add(nd,t,ct,hF,hC){if(hF&&!ct){return;}var li=d.createElement("li");li.innerHTML=["<b>",t,"</b>",(hC?"":": "+(ct instanceof Object?JSON.stringify(ct):ct))].join("");nd.appendChild(li);}function aSL(nd,t,ct){var li=d.createElement("li"),ul=d.createElement("ul"),i;li.innerHTML="<b>"+t+":</b>";for(i in ct){add(ul,i,ct[i],1);}li.appendChild(ul);nd.appendChild(li);}function queryMe(f){if(!f.length){return;}var data=f.shift();ajax(data.url+"?f=json",function(r){var dF=d.createDocumentFragment(),ul=d.createElement("ul");r=JSON.parse(r);add(dF,"Description",r.description,true);add(dF,"Service Description",r.serviceDescription,true);add(dF,"&copy;",r.copyrightText,true);add(dF,"Supports Dynamic Layers",0,r.supportsDynamicLayers,1);add(dF,"# Layers",r.layers?r.layers.length:0);add(dF,"# Tables",r.tables?r.tables.length:0,1);add(dF,"Tiled or Dynamic",r.tileInfo?" tiled":" dynamic");add(dF,"Spatial Reference",JSON.stringify(r.spatialReference||"none"));add(dF,"Min Scale",r.minScale||"None");add(dF,"Max Scale",r.maxScale||"None");aSL(dF,"Initial Extent",r.initialExtent);aSL(dF,"Full Extent",r.fullExtent);add(dF,"Units",r.units.replace("esri",""));aSL(dF,"Document Info",r.documentInfo);add(dF,"Max Record Count",r.maxRecordCount);tags[data.i].parentNode.appendChild(ul);ul.appendChild(dF);if(f.length){queryMe(f);}});}for(i=0;i<tags.length;i++){if(/(map|feature|image|mobile)server\/?$/i.test(tags[i].href)){urls.push({i:i,url:tags[i].href});}if(urls&&urls.length){queryMe(urls);}}}());' title='MapService Reviewer v 0.3'>MapService Data Extractor v 0.3</a></li>
		<li><a href='javascript:(function(){var d=document,tags=d.getElementsByTagName("a"),urls=[],i;function ajax(u,callback,data,x){try{x=new(this.XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");x.open(data?"POST":"GET",u,1);x.setRequestHeader("X-Requested-With","XMLHttpRequest");x.setRequestHeader("Content-type","application/x-www-form-urlencoded");x.onreadystatechange=function(){x.readyState>3&&callback&&callback(x.responseText,x);};x.send(data);}catch(e){window.console&&console.log(e);}}function add(frag,t,c){var li=d.createElement("li");li.innerHTML=["<b>",t,"</b>",c?": ":"",c].join("");frag.appendChild(li);}function queryMe(f){if(!f.length){return;}var data=f.shift();ajax(data.url+"?f=json",function(r){var dF=d.createDocumentFragment(),ul=d.createElement("ul");r=JSON.parse(r);add(dF,"Geometry",r.geometryType.replace("esriGeometry",""));add(dF,"Min Scale",r.minScale||"None");add(dF,"Max Scale",r.maxScale||"None");if(r.definitionExpression){add(dF,"Definition Expression",r.definitionExpression);}add(dF,"Visible by default",r.defaultVisibility.toString());if(r.hasAttachments){add(dF,"Has Attachments");}if(r.hasLabels){add(dF,"Has Labels");}if(r.supportsStatistics){add(dF,"Supports Statistics");}if(r.supportsAdvancedQueries){add(dF,"Supports Advanced Queries");}if(r.relationships&&r.relationships.length){add(dF,"Has Relationships");}add(dF,"Versioned Data",r.isDataVersioned?"Yes":"No");tags[data.i].parentNode.appendChild(ul);ul.appendChild(dF);if(f.length){queryMe(f);}});}if(/(map|feature)server\/?$/i.test(window.location.href)){for(i=0;i<tags.length;i++){if(/server\/\d+\/?$/i.test(tags[i].href)){urls.push({i:i,url:tags[i].href});}if(urls&&urls.length){queryMe(urls);}}}else{if(/server\/\d+\/?$/i.test(window.location.href)){alert("Go to the parent map service layer.");}else{alert("Pick a valid layer");}}}());' title='Layer Property Extractor'>Layer Property Extractor v. 0.1</a></li>
		<li><a href='javascript:(function(){var d=document,tags=d.getElementsByTagName("a"),urls=[],i;function ajax(u,callback,data,x){try{x=new(this.XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");x.open(data?"POST":"GET",u,1);x.setRequestHeader("X-Requested-With","XMLHttpRequest");x.setRequestHeader("Content-type","application/x-www-form-urlencoded");x.onreadystatechange=function(){x.readyState>3&&callback&&callback(JSON.parse(x.responseText),x);};x.send(data);}catch(e){window.console&&console.log(e);}}function add(frag,t,ct){var li=d.createElement("li");li.innerHTML=["<b>",t,"</b>",ct!=null?": ":"",ct].join("");frag.appendChild(li);}function queryMe(f){if(!f.length){return;}var data=f.shift();ajax(data.url+"?f=json",function(r){var ul=d.createElement("ul"),oid=null,shape=null,newURL=data.url+"/query?where=not+field+is+null&returnGeometry=false&returnCountOnly=true&f=json",j;if(r.fields){for(j=0;j<r.fields.length;j++){switch(r.fields[j].type){case"esriFieldTypeOID":case"":oid=r.fields[j].name;break;case"esriFieldTypeGeometry":shape=r.fields[j].name;break;}if(oid&&shape){break;}}}if(oid){ajax(newURL.replace("field",oid),function(cnt){add(ul,"Number of Results",cnt.count);});}if(shape){ajax(newURL.replace("field",shape),function(cnt){add(ul,"With geometry",cnt.count);});}if(r.fields&&!oid&&!shape){add(ul,"No Queryable Results");}tags[data.i].parentNode.appendChild(ul);if(f.length){queryMe(f);}});}if(/(map|feature)server\/?$/i.test(window.location.href)){for(i=0;i<tags.length;i++){if(/server\/\d+\/?$/i.test(tags[i].href)){urls.push({i:i,url:tags[i].href});}}if(urls&&urls.length){queryMe(urls);}}else{if(/server\/\d+\/?$/i.test(window.location.href)){alert("Go to the parent map service layer.");}else{alert("Pick a valid layer");}}}());' title='Layer Feature Counter'>Layer Feature Counter v. 0.1</a></li>
		<li><a href='javascript:(function(){var url="http://js.arcgis.com/3.10/",scr1;function loadMe(){require(["dojo/ready","dojo/dom-construct","dojo/on","esri/request","dojo/_base/lang","dojo/_base/array"],function(ready,domConstruct,on,esriRequest,lang,array){function getFinalVal(fields,response){var result=response.hasOwnProperty(fields[0])?response[fields[0]]:null;if(result!=null&&fields.length>1){if(result instanceof Array){return array.map(result,function(item){return getFinalVal(fields.slice(1),item);});}return getFinalVal(fields.slice(1),result);}return result;}function printResult(field,result,url,node){domConstruct.create("a",{innerHTML:[field,result].join(": "),href:url},node);domConstruct.create("br", {}, node);}function checkAndPrint(searchFor,field,result,url,node){if(isNaN(searchFor)){if(searchFor.test(result)){printResult(field,result,url,node);}}else if(searchFor===result){printResult(field,result,url,node);}}function responseSearch(url,resp,fieldList,searchFor,node){array.forEach(fieldList,function(field){var result=getFinalVal(field.split("."),resp);if(result==null){return;}if(result instanceof Array){array.forEach(result,function(item){checkAndPrint(searchFor,field,item,url,node);});}else{checkAndPrint(searchFor,field,result,url,node);}});}function mapLayerSearch(url,node,searchFor){esriRequest({url:url,handleAs:"json",content:{f:"json"}}).then(function(resp){responseSearch(url,resp,["name","description","displayField","fields.name","fields.alias"],searchFor,node);});}function mapServiceSearch(url,node,searchFor){esriRequest({url:url,handleAs:"json",content:{f:"json"}}).then(function(resp){responseSearch(url,resp,["mapName","layers.name","documentInfo.Title","documentInfo.Comments","documentInfo.Subject","documentInfo.Category","documentInfo.Keywords"],searchFor,node);if(resp.layers&&resp.layers.length){array.forEach(resp.layers,function(layer){mapLayerSearch([url,layer.id].join("/"),node,searchFor);});}if(resp.tables&&resp.tables.length){array.forEach(resp.tables,function(table){mapLayerSearch([url,table.id].join("/"),node,searchFor);});}});}function folderSearch(url,node,searchFor){esriRequest({url:url,handleAs:"json",content:{f:"json"}}).then(function(resp){responseSearch(url,resp,["folder","service.name"],searchFor,node);if(resp.folders&&resp.folders.length){array.forEach(resp.folders,function(folder){folderSearch([url,folder].join("/"),node,searchFor);});}if(resp.services&&resp.services.length){array.forEach(resp.services,function(service){mapServiceSearch([url,service.name.replace(/\w+\//ig, ""),service.type].join("/"),node,searchFor);});}});}ready(function(){var div=domConstruct.create("div",{style:"position:fixed;bottom:5px;top:50%;right:5px;width:50%;border:1px solid #880;padding:5px;background:#fff;overflow:auto;text-align:center;"},document.body),searchFor;domConstruct.create("button",{type:"button",innerHTML:"Close",style:"float: right;",onclick:function(){domConstruct.destroy(div);}},div);searchFor=prompt("What would you like to search for?");if(/^\d*\.?\d+$/.test(searchFor)){searchFor=/\./.test(searchFor)?parseFloat(searchFor):parseInt(searchFor,10);}else{searchFor=new RegExp(searchFor);}url=window.location.href;if(/\/\d+\/?$/.test(url)){mapLayerSearch(url,div,searchFor);}else if(/\/\w+server\/?$/.test(url)){mapServiceSearch(url,div,searchFor);}else{folderSearch(url,div,searchFor);}});});}function scriptLoaded(url){var scripts=document.getElementsByTagName("script"),i;for(i=scripts.length-1;i>-1;i--){if(scripts[i].src===url){return true;}}return false;}if(!scriptLoaded(url)){scr1=document.createElement("script");scr1.setAttribute("type","text/javascript");scr1.onload=loadMe;scr1.setAttribute("src",url);document.body.appendChild(scr1);}else{loadMe();}}());' title='Rest Search v 0.1'>Rest Search v 0.1</a></li>
		<li><a href='javascript:(function(){var url="http://js.arcgis.com/3.10/",css=url+"js/esri/css/esri.css",d=document,style1,scr1;function loadMe(){require(["dojo/ready","dojo/dom-construct","dojo/query","dojo/json","esri/request","esri/toolbars/draw","esri/map","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ArcGISTiledMapServiceLayer"],function(ready,dC,dQ,JSON,esriRequest,Draw,Map,Dynamic,Tiled){ready(function(){var wl=window.location,url=wl.href.replace(wl.search,"").replace(/\/\d+\/query\/?$/i,""),geoBlank=dQ("textarea[name=\"geometry\"]"),geoSelect=dQ("select[name=\"geometryType\"]")[0];esriRequest({url:url,handleAs:"json",content:{f:"json"}}).then(function(resp){var div=dC.create("div",{style:"position:fixed;bottom:15%;top:15%;right:0;width:40%;border:1px solid #F88;padding:5px;background:#fff;overflow:auto;",innerHTML:"<button "+["id=\"btnpt\">Point","id=\"btnln\">Line","id=\"btnpg\">Polygon","id=\"btnex\">Extent"].join("</button><button ")+"</button><button id=\"closr\">Close</button><div id=\"map\" style=\"width:100%;\"></div>"},d.body),map=new Map("map",{}),layer=resp.singleFusedMapCache?new Tiled(url):new Dynamic(url),xlator={btnpt:Draw.POINT,btnln:Draw.POLYLINE,btnpg:Draw.POLYGON,btnex:Draw.EXTENT},draw;map.on("load",function(){draw=new Draw(map);dQ("button",div).on("click",function(evt){if(evt.target.id in xlator){draw.activate(xlator[evt.target.id]);}else{map.destroy();dC.destroy(div);}});draw.on("draw-end",function(drawn){var i,xlator={point:"esriGeometryPoint",multipoint:"esriGeometryMultipoint",polyline:"esriGeometryPolyline",polygon:"esriGeometryPolygon",extent:"esriGeometryEnvelope"};for(i=geoSelect.options.length-1;i>-1;i--){if(geoSelect.options[i].value===xlator[drawn.geometry.type]){geoSelect.selectedIndex=i;break;}}geoBlank.value=JSON.stringify(drawn.geometry.toJson());});});map.addLayer(layer);geoBlank=geoBlank&&geoBlank.length?geoBlank[0]:dC.create("textarea",{},div);});});});}function scriptLoaded(url){var scripts=d.getElementsByTagName("script"),i;for(i=scripts.length-1;i>-1;i--){if(scripts[i].src===url){return true;}}return false;}if(!scriptLoaded(url)){style1=d.createElement("link");style1.setAttribute("rel","stylesheet");style1.setAttribute("type","text/css");style1.href=css;d.head.appendChild(style1);scr1=d.createElement("script");scr1.setAttribute("type","text/javascript");scr1.onload=loadMe;scr1.setAttribute("src",url);d.body.appendChild(scr1);}else{loadMe();}}());' title='Geometry Helper'>Geometry Helper</a></li>
	</ul>
</body>
</html>