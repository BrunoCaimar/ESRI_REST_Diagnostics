<!DOCTYPE HTML>
<html>
<head>
	<title>ESRI REST Diagnoatics</title>
</head>
<body>
	<h1>ESRI Rest Diagnostics</h1>
	<p>This page provides links to tools that can be used to inspect and pull out data out of ArcGIS REST Services.</p>
	<ul>
		<li>
			Map Folder Level:
			<ul>
				<li><a href='javascript:(function(){var d=document,tags=d.getElementsByTagName("a"),urls=[],cH={},i;function getFL(k){var nL="",wl=window.location;if(k.indexOf(wl.protocol)===0){return k;}nL+=wl.protocol+"//";if(k.indexOf(wl.hostname)===0){return nL+k;}nL+=wl.hostname;if(k.indexOf(wl.pathname)===0){return nL+k;}return nL+wl.pathname+k;}function getC(item){if(cH[item]){return cH[item];}cH[item]="#"+(0x1000000+(Math.random())*0xffffff).toString(16).substr(1,6);return cH[item];}function getCC(item){var col=cH[item],newcol="",mid=[col.substr(1,1),col.substr(3,1),col.substr(5,1)].sort()[1],coltbl="fedcba98".indexOf(mid)>-1?"0000000001234567":"89abcdefffffffff",c;for(c=0;c<col.length;c++){newcol+=c%2===1?coltbl[parseInt(col.substr(c,1),16)]:col.substr(c,1);}return newcol;}function srNode(sr){var n,val="&nbsp;No valid spatial reference available &nbsp;",el="span";if(sr){val=sr.latestWkid||sr.wkid||sr.latestWkt||sr.wkt||noval;if(sr.latestWkid||sr.wkid){el="a";}}n=d.createElement(el);if(el==="a"){n.setAttribute("href","http://spatialreference.org/ref/?search="+val);}n.setAttribute("style",["color:",getC(val),";background:",getCC(val),";"].join(""));n.innerHTML=val;return n;}function ajax(u,callback,data,x){try{x=new(this.XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");x.open(data?"POST":"GET",u,1);x.setRequestHeader("X-Requested-With","XMLHttpRequest");x.setRequestHeader("Content-type","application/x-www-form-urlencoded");x.onreadystatechange=function(){x.readyState>3&&callback&&callback(x.responseText,x);};x.send(data);}catch(e){window.console&&console.log(e);}}function queryMe(f){if(!f.length){return;}var data=f.shift();ajax(data.url+"?f=json",function(r){r=JSON.parse(r);var node=srNode(r.spatialReference),n2=d.createElement("b");n2.innerHTML=r.singleFusedMapCache?"tiled":"dynamic";data.link.parentNode.appendChild(node);data.link.parentNode.appendChild(n2);if(f.length){queryMe(f);}});}for(i=0;i<tags.length;i++){if(/(map|feature|image|mobile)server\/?$/i.test(tags[i].href)){urls.push({link:tags[i],url:getFL(tags[i].href)});}}if(urls&&urls.length){queryMe(urls);}else{alert("Pick a REST Service folder with services");}}());' title='Spatial Reference Comparison'>Spatial Reference Comparison</a></li>
				<li><a href='javascript:(function(){var d=document,tags=d.getElementsByTagName("a"),urls=[],i;function ajax(u,callback,data,x){try{x=new(this.XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");x.open(data?"POST":"GET",u,1);x.setRequestHeader("X-Requested-With","XMLHttpRequest");x.setRequestHeader("Content-type","application/x-www-form-urlencoded");x.onreadystatechange=function(){x.readyState>3&&callback&&callback(x.responseText,x);};x.send(data);}catch(e){window.console&&console.log(e);}}function add(nd,t,ct,hF,hC){if(hF&&!ct){return;}var li=d.createElement("li");li.innerHTML=["<b>",t,"</b>",(hC?"":": "+(ct instanceof Object?JSON.stringify(ct):ct))].join("");nd.appendChild(li);}function aSL(nd,t,ct){var li=d.createElement("li"),ul=d.createElement("ul"),i;li.innerHTML="<b>"+t+":</b>";for(i in ct){add(ul,i,ct[i],1);}li.appendChild(ul);nd.appendChild(li);}function queryMe(f){if(!f.length){return;}var data=f.shift();ajax(data.url+"?f=json",function(r){var dF=d.createDocumentFragment(),ul=d.createElement("ul");r=JSON.parse(r);add(dF,"Description",r.description,true);add(dF,"Service Description",r.serviceDescription,true);add(dF,"&copy;",r.copyrightText,true);add(dF,"Supports Dynamic Layers",0,r.supportsDynamicLayers,1);add(dF,"# Layers",r.layers?r.layers.length:0);add(dF,"# Tables",r.tables?r.tables.length:0,1);add(dF,"Tiled or Dynamic",r.tileInfo?" tiled":" dynamic");add(dF,"Spatial Reference",JSON.stringify(r.spatialReference||"none"));add(dF,"Min Scale",r.minScale||"None");add(dF,"Max Scale",r.maxScale||"None");aSL(dF,"Initial Extent",r.initialExtent);aSL(dF,"Full Extent",r.fullExtent);add(dF,"Units",r.units.replace("esri",""));aSL(dF,"Document Info",r.documentInfo);add(dF,"Max Record Count",r.maxRecordCount);tags[data.i].parentNode.appendChild(ul);ul.appendChild(dF);if(f.length){queryMe(f);}});}for(i=0;i<tags.length;i++){if(/(map|feature|image|mobile)server\/?$/i.test(tags[i].href)){urls.push({i:i,url:tags[i].href});}if(urls&&urls.length){queryMe(urls);}}}());' title='MapService Reviewer v 0.3'>MapService Data Extractor v 0.3</a></li>
				<li><a href='javascript:(function(){var h=document,a=window.location.href.replace(window.location.search,""),k=/(map|feature)server\/?$/i.test(a),g=false,b="//js.arcgis.com/3.15compact",f="//js.arcgis.com/3.15/esri/css/esri.css",j,i;function c(d,m){var n=h.createElement(d),l;for(l in m){n.setAttribute(l,m[l])}return n}function e(){var d=c("div",{style:"position:fixed;top:0;right:0;border:1px solid grey;z-index:10;padding:8px;background:#fff;"});d.innerHTML="<div id=\"map\"></div>"+(!k?"<p>Hover over a Map Service link to view it.</p>":"");h.body.appendChild(d);require(["esri/map","esri/request","dojo/query","dojo/domReady!"],function(m,q,o){var p=new m("map");function l(t,s){if(t.layers&&t.layers.length){require(["esri/layers/FeatureLayer","dojo/_base/array"],function(v,u){u.forEach(t.layers,function(x){var w=new v(s.replace(/\/?$/,"/"+x.id),{mode:v.MODE_SNAPSHOT,outFields:["*"]});p.addLayer(w)})})}}function r(t,s){if(t.singleFusedMapCache){require(["esri/layers/ArcGISTiledMapServiceLayer"],function(u){var v=new u(s);p.addLayer(v)})}else{require(["esri/layers/ArcGISDynamicMapServiceLayer"],function(v){var u=new v(s);p.addLayer(u)})}}function n(){if(p.graphicsLayerIds.length+p.layerIds.length>0){p.destroy();p=new m("map")}}if(k){r(a)}else{o("a[href$=MapServer]").on("mouseover",function(s){var t=s.currentTarget.href;n();q({url:t,handleAs:"json",content:{f:"json"}}).then(function(u){r(u,t)},function(u){console.error(u)})});o("a[href$=FeatureServer]").on("mouseover",function(s){var t=s.currentTarget.href;n();q({url:t,handleAs:"json",content:{f:"json"}}).then(function(u){l(u,t)},function(u){console.error(u)})})}})}g=[].some.call(h.getElementsByTagName("script"),function(d){return d.src===b});if(g){e()}else{j=c("link",{rel:"stylesheet",type:"text/css",href:f});h.head.appendChild(j);i=c("script",{type:"text/javascript"});i.onload=e;i.setAttribute("src",b);h.body.appendChild(i)}}());' title='Map Viewer v. 0.5'>Map Viewer v. 0.5</a></li>
			</ul>
		</li>
		<li>
			Map Service Level:
			<ul>
				<li><a href='javascript:(function(){var d=document,tags=d.getElementsByTagName("a"),urls=[],i;function ajax(u,callback,data,x){try{x=new(this.XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");x.open(data?"POST":"GET",u,1);x.setRequestHeader("X-Requested-With","XMLHttpRequest");x.setRequestHeader("Content-type","application/x-www-form-urlencoded");x.onreadystatechange=function(){x.readyState>3&&callback&&callback(x.responseText,x);};x.send(data);}catch(e){window.console&&console.log(e);}}function add(frag,t,c){var li=d.createElement("li");li.innerHTML=["<b>",t,"</b>",c?": ":"",c].join("");frag.appendChild(li);}function queryMe(f){if(!f.length){return;}var data=f.shift();ajax(data.url+"?f=json",function(r){var dF=d.createDocumentFragment(),ul=d.createElement("ul");r=JSON.parse(r);add(dF,"Geometry",r.geometryType.replace("esriGeometry",""));add(dF,"Min Scale",r.minScale||"None");add(dF,"Max Scale",r.maxScale||"None");if(r.definitionExpression){add(dF,"Definition Expression",r.definitionExpression);}add(dF,"Visible by default",r.defaultVisibility.toString());if(r.hasAttachments){add(dF,"Has Attachments");}if(r.hasLabels){add(dF,"Has Labels");}if(r.supportsStatistics){add(dF,"Supports Statistics");}if(r.supportsAdvancedQueries){add(dF,"Supports Advanced Queries");}if(r.relationships&&r.relationships.length){add(dF,"Has Relationships");}add(dF,"Versioned Data",r.isDataVersioned?"Yes":"No");tags[data.i].parentNode.appendChild(ul);ul.appendChild(dF);if(f.length){queryMe(f);}});}if(/(map|feature)server\/?$/i.test(window.location.href)){for(i=0;i<tags.length;i++){if(/server\/\d+\/?$/i.test(tags[i].href)){urls.push({i:i,url:tags[i].href});}if(urls&&urls.length){queryMe(urls);}}}else{if(/server\/\d+\/?$/i.test(window.location.href)){alert("Go to the parent map service layer.");}else{alert("Pick a valid layer");}}}());' title='Layer Property Extractor'>Layer Property Extractor v. 0.1</a></li>
				<li><a href='javascript:(function(){var d=document,tags=d.getElementsByTagName("a"),urls=[],i;function ajax(u,callback,data,x){try{x=new(this.XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");x.open(data?"POST":"GET",u,1);x.setRequestHeader("X-Requested-With","XMLHttpRequest");x.setRequestHeader("Content-type","application/x-www-form-urlencoded");x.onreadystatechange=function(){x.readyState>3&&callback&&callback(JSON.parse(x.responseText),x);};x.send(data);}catch(e){window.console&&console.log(e);}}function add(frag,t,ct){var li=d.createElement("li");li.innerHTML=["<b>",t,"</b>",ct!=null?": ":"",ct].join("");frag.appendChild(li);}function queryMe(f){if(!f.length){return;}var data=f.shift();ajax(data.url+"?f=json",function(r){var ul=d.createElement("ul"),oid=null,shape=null,newURL=data.url+"/query?where=not+field+is+null&returnGeometry=false&returnCountOnly=true&f=json",j;if(r.fields){for(j=0;j<r.fields.length;j++){switch(r.fields[j].type){case"esriFieldTypeOID":case"":oid=r.fields[j].name;break;case"esriFieldTypeGeometry":shape=r.fields[j].name;break;}if(oid&&shape){break;}}}if(oid){ajax(newURL.replace("field",oid),function(cnt){add(ul,"Number of Results",cnt.count);});}if(shape){ajax(newURL.replace("field",shape),function(cnt){add(ul,"With geometry",cnt.count);});}if(r.fields&&!oid&&!shape){add(ul,"No Queryable Results");}tags[data.i].parentNode.appendChild(ul);if(f.length){queryMe(f);}});}if(/(map|feature)server\/?$/i.test(window.location.href)){for(i=0;i<tags.length;i++){if(/server\/\d+\/?$/i.test(tags[i].href)){urls.push({i:i,url:tags[i].href});}}if(urls&&urls.length){queryMe(urls);}}else{if(/server\/\d+\/?$/i.test(window.location.href)){alert("Go to the parent map service layer.");}else{alert("Pick a valid layer");}}}());' title='Layer Feature Counter'>Layer Feature Counter v. 0.1</a></li>
				<li><a href='javascript:(function(){var d=document,tags=d.getElementsByTagName("a"),urls=[],i;function iA(n,r){r.parentNode.insertBefore(n,r.nextSibling);}function Result(m,c){var k=d.createElement("span");k.innerHTML=m;k.setAttribute("style","font-weight:bold;color:"+c+";");return k;}function oS(index){iA(Result(" OK ","green"),tags[index]);this.parentNode.removeChild(this);}function oE(index,error){iA(Result(" !!! ","red"),tags[index]);console.error(error);this.parentNode.removeChild(this);}function queryMe(f){if(!f.length){return;}var data=f.shift(),img=d.createElement("img");img.onerror=function(err){oE.call(this,data.i,err);};img.onload=function(){oS.call(this,data.i);};img.setAttribute("src",data.url);iA(img,tags[data.i]);setTimeout(function(){queryMe(f);},50);}if(/(map|feature)server\/?$/i.test(window.location.href)){for(i=0;i<tags.length;i++){if(/server\/tile\/\d+\/\d+\/\d+\/?$/i.test(tags[i].href)){urls.push({i:i,url:tags[i].href});}}if(urls&&urls.length){queryMe(urls);}}else{if(/server\/\d+\/?$/i.test(window.location.href)){alert("Go to the parent map service layer.");}else{alert("Pick a valid layer");}}}());' title='Tiled Service Tester'>Tiled Service Tester v. 0.1</a></li>
				<li><a href='javascript:(function(){var h=document,a=window.location.href.replace(window.location.search,""),k=/(map|feature)server\/?$/i.test(a),g=false,b="//js.arcgis.com/3.15compact",f="//js.arcgis.com/3.15/esri/css/esri.css",j,i;function c(d,m){var n=h.createElement(d),l;for(l in m){n.setAttribute(l,m[l])}return n}function e(){var d=c("div",{style:"position:fixed;top:0;right:0;border:1px solid grey;z-index:10;padding:8px;background:#fff;"});d.innerHTML="<div id=\"map\"></div>"+(!k?"<p>Hover over a Map Service link to view it.</p>":"");h.body.appendChild(d);require(["esri/map","esri/request","dojo/query","dojo/domReady!"],function(m,q,o){var p=new m("map");function l(t,s){if(t.layers&&t.layers.length){require(["esri/layers/FeatureLayer","dojo/_base/array"],function(v,u){u.forEach(t.layers,function(x){var w=new v(s.replace(/\/?$/,"/"+x.id),{mode:v.MODE_SNAPSHOT,outFields:["*"]});p.addLayer(w)})})}}function r(t,s){if(t.singleFusedMapCache){require(["esri/layers/ArcGISTiledMapServiceLayer"],function(u){var v=new u(s);p.addLayer(v)})}else{require(["esri/layers/ArcGISDynamicMapServiceLayer"],function(v){var u=new v(s);p.addLayer(u)})}}function n(){if(p.graphicsLayerIds.length+p.layerIds.length>0){p.destroy();p=new m("map")}}if(k){r(a)}else{o("a[href$=MapServer]").on("mouseover",function(s){var t=s.currentTarget.href;n();q({url:t,handleAs:"json",content:{f:"json"}}).then(function(u){r(u,t)},function(u){console.error(u)})});o("a[href$=FeatureServer]").on("mouseover",function(s){var t=s.currentTarget.href;n();q({url:t,handleAs:"json",content:{f:"json"}}).then(function(u){l(u,t)},function(u){console.error(u)})})}})}g=[].some.call(h.getElementsByTagName("script"),function(d){return d.src===b});if(g){e()}else{j=c("link",{rel:"stylesheet",type:"text/css",href:f});h.head.appendChild(j);i=c("script",{type:"text/javascript"});i.onload=e;i.setAttribute("src",b);h.body.appendChild(i)}}());' title='Map Viewer v. 0.5'>Map Viewer v. 0.5</a></li>
			</ul>
		</li>
		<li>
			Map Layer Level:
			<ul>
				<li><a href='javascript:(function(){var url=window.location.href,d=document;function ajax(u,callback,data,x){try{x=new(this.XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");x.open(data?"POST":"GET",u,1);x.setRequestHeader("X-Requested-With","XMLHttpRequest");x.setRequestHeader("Content-type","application/x-www-form-urlencoded");x.onreadystatechange=function(){x.readyState>3&&callback&&callback(x.responseText,x);};x.send(data);}catch(e){window.console&&console.log(e);}}function responseTime(timeValue){var timeDiff=Date.now()-timeValue;return""+(timeDiff>1000?timeDiff/1000:timeDiff+"m")+"s";}function queryMe(f,nodes){if(!f.length){return;}var field=f.shift(),node=nodes.shift(),params="/query?where=not+field+is+null&returnGeometry=false&returnCountOnly=true&f=json".replace("field",field.name),timeCheck=Date.now();ajax(url+params,function(response){response=JSON.parse(response);var tr=d.createElement("ul");tr.innerHTML="<li>"+["<b>Features with values: </b>"+response.count+(!response.count?"<b style=\"color:#f00;\"> !!!</b>":""),"<b>Response Time: </b>"+responseTime(timeCheck)].join("</li><li>")+"</li>";node.appendChild(tr);if(f.length){queryMe(f,nodes);}});}function getFieldList(){var uls=d.getElementsByTagName("ul"),labels=[].map.call(uls,function(node){var h=node;while(h.previousSibling){h=h.previousSibling;if(h.tagName==="B")break;}return h.innerHTML;}),i;for(i=uls.length-1;i>-1;i--){if(/^Fields\:/.test(labels[i])){return[].map.call(uls[i].children,function(j){return j;});}}return null;}function onLoad(response){response=JSON.parse(response);if(response.fields){queryMe(response.fields,getFieldList());}}if(/\d+\/?$/.test(url)){ajax(url+"?f=json",onLoad);}else{if(!/(map|feature)server\/?$/i.test(url)){alert("Pick a map/feature service and layer");}else{alert("Pick a valid layer");}}}());' title='Field Tester (null only)'>Field Value Tester (null test only) v. 0.4</a></li>
				<li><a href='javascript:(function(){"use strict";var b=window.location.href,h=document;function g(i,l,j,d){try{d=new (window.XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");d.open(j?"POST":"GET",i,1);d.setRequestHeader("X-Requested-With","XMLHttpRequest");d.setRequestHeader("Content-type","application/x-www-form-urlencoded");d.onreadystatechange=function(){d.readyState>3&&l&&l(d.responseText,d)};d.send(j)}catch(k){window.console&&console.log(k)}}function f(d){var i=Date.now()-d;return""+(i>1000?i/1000:i+"m")+"s"}function c(j,d){if(!j.length){return}var k=j.shift(),i=d.shift(),l="/query?where=not+field+is+null&returnGeometry=false&returnCountOnly=true&f=json".replace(/field/g,k.name),m=Date.now();if(k.type==="esriFieldTypeString"){l=l.replace("is+null","is+null+and+"+k.name+"+<>%27%27")}g(b+l,function(n){n=JSON.parse(n);var o=h.createElement("ul");o.innerHTML="<li>"+["<b>Features with populated values: </b>"+n.count+(!n.count?"<b style=\"color:#f00;\"> !!!</b>":""),"<b>Response Time: </b>"+f(m)].join("</li><li>")+"</li>";i.appendChild(o);if(j.length){c(j,d)}})}function a(){var j=h.getElementsByTagName("ul"),k=[].map.call(j,function(l){var i=l;while(i.previousSibling){i=i.previousSibling;if(i.tagName==="B"){break}}return i.innerHTML}),d;for(d=j.length-1;d>-1;d--){if(/^Fields\:/.test(k[d])){return[].map.call(j[d].children,function(i){return i})}}return null}function e(d){d=JSON.parse(d);if(d.fields){c(d.fields,a())}}if(/\d+\/?$/.test(b)){g(b+"?f=json",e)}else{if(!/(map|feature)server\/?$/i.test(b)){alert("Pick a map/feature service and layer")}else{alert("Pick a valid layer")}}}());' title='Populated Field Tester (null and empty string)'>Populated Field Value Tester (null or empty string) v. 0.9</a></li>
				<li><a href='javascript:(function(){var b=window.location.href,g=document;function f(h,k,i,d){try{d=new (this.XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");d.open(i?"POST":"GET",h,1);d.setRequestHeader("X-Requested-With","XMLHttpRequest");d.setRequestHeader("Content-type","application/x-www-form-urlencoded");d.onreadystatechange=function(){d.readyState>3&&k&&k(d.responseText,d)};d.send(i)}catch(j){window.console&&console.log(j)}}function c(l,d,k){if(!l.length){return}if(!k){var i=d.shift();k=g.createElement("ul");i.appendChild(k)}if(l[0].length){var h=l[0].shift(),j=h.type==="esriFieldTypeString"?"%27"+h.code+"%27":h.code,m="/query?where=field+%3D+value&returnGeometry=false&returnCountOnly=true&f=json".replace("field",h.field).replace("value",j);f(b+m,function(o){o=JSON.parse(o);var n=g.createElement("li");n.innerHTML=["<b>",h.name,": </b>",o.count,(!o.count?"<b style=\"color:#f00;\"> !!!</b>":"")].join("");k.appendChild(n);if(l[0].length){c(l,d,k)}else{l.shift();if(l.length){c(l,d)}}})}}function a(){var h=g.getElementsByTagName("ul"),j=[].map.call(h,function(k){var i=k;while(i.previousSibling){i=i.previousSibling;if(i.tagName==="B"){break}}return i.innerHTML}),d;for(d=h.length-1;d>-1;d--){if(/^Fields\:/.test(j[d])){return[].map.call(h[d].children,function(i){return i})}}return null}function e(j){var h,d=[],k,l;j=JSON.parse(j);if(j.fields){h=a();for(k=j.fields.length-1;k>-1;k--){l=j.fields[k];if(l.domain){if(l.domain.codedValues){d.push(l.domain.codedValues.map(function(i){i.field=l.name;i.type=l.type;return i}))}else{if(l.domain.range){}}}else{h.splice(k,1)}}d.reverse();c(d,h,null)}}if(/\d+\/?$/.test(b)){f(b+"?f=json",e)}else{if(!/(map|feature)server\/?$/i.test(b)){alert("Pick a map/feature service and layer")}else{alert("Pick a valid layer")}}}());' title='Domain Data Counter'>Domain Data Counter v. 0.3</a></li>
			</ul>
		</li>
		<li>
			Query Page Level:
			<ul>
				<li><a href='javascript:(function(){var f=document,k=window.location,b=k.href.replace(k.search,""),h=/\/query\/?$/i,e;function i(l,o,m,d){try{d=new (this.XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");d.open(m?"POST":"GET",l,1);d.setRequestHeader("X-Requested-With","XMLHttpRequest");d.setRequestHeader("Content-type","application/x-www-form-urlencoded");d.onreadystatechange=function(){d.readyState>3&&o&&o(JSON.parse(d.responseText),d)};d.send(m)}catch(n){window.console&&console.log(n)}}function c(m,d,l,n){[].forEach.call(m.querySelectorAll(d),function(o){o[l]=n})}function j(l){var o=f.createElement("div"),m=f.createElement("select"),d=f.createElement("select"),n=f.createElement("div");o.setAttribute("style","position:fixed;top:10%;right:0;width:35%;padding:5px;background:#fff;overflow:auto;");o.innerHTML="<button style=\"float:right;\" onclick=\"this.parentNode.parentNode.removeChild(this.parentNode);\">Close</button><b>Query Builder</b><br />";f.body.appendChild(o);m.setAttribute("size","10");m.innerHTML=l.map(function(p){return["<option value=\"",p.name,"\">",p.alias,"</option>"].join("")}).join("");o.appendChild(m);d.setAttribute("size","10");o.appendChild(d);m.onchange=function(){var p=m.value;i(b+"?where=1%3D1&returnGeometry=false&outFields=field&orderByFields=field&returnDistinctValues=true&f=json".replace(/field/g,p),function(q){d.innerHTML=[].map.call(q.features,function(r){return["<option value=\"",r.attributes[p],"\">",r.attributes[p],"</option>"].join("")})})};n.innerHTML=[" = "," &lt;&gt; "," LIKE "," &gt; "," &gt;= "," AND "," &lt; "," &lt;= "," OR ","_","%","()","NOT "," IS ","*","&#39;&#39;"," IN ",", "].map(function(p){return["<button class=\"sql\" type=\"button\" name=\"",p,"\">",p.replace(/\s+/g,""),"</button>"].join("")});o.appendChild(n);return o}function a(n){var m=e.value.substring(0),o=m.length;e.focus();if(f.selection){var d=f.selection.createRange();d.moveStart("character",-e.value.length);o=d.text.length}else{if("selectionStart" in e){o=e.selectionStart}}e.value=m.substring(0,o)+n+m.substring(o);o+=n.length-(["()",decodeURIComponent("%27%27")].indexOf(n)>-1);if(e.createTextRange){var l=e.createTextRange();l.move("character",o);l.select()}else{if("selectionStart" in e){e.setSelectionRange(o,o)}}}function g(d){var l=j(d.fields);c(l,"select","onclick",function(m){a(m.currentTarget.value)});c(l,"button.sql","onclick",function(m){a(m.currentTarget.name)})}c(f,"input[type=text], textarea","onblur",function(){e=this});if(h.test(b)){i(b.replace(h,"")+"?f=json",g)}else{if(!/(map|feature)server\/\d+\/?$/i.test(b)){alert("Go to the query page to use this tool.")}else{alert("Pick a valid layer")}}}());' title='Select By Attributes Query Helper'>Select By Attributes Query Helper v. 0.3</a></li>
				<li><a href='javascript:(function(){var a=window.location.href.split("?")[0];function d(e){return[].map.call(document.getElementsByTagName(e),function(f){return f})}function b(){return d("INPUT").concat(d("TEXTAREA"))}function c(f){var e={where:"1=1",outFields:"*",returnGeometry:"true"};f.forEach(function(g){if(e.hasOwnProperty(g.name)){if(g.type&&g.type==="radio"&&e[g.name]===g.value){g.checked=true}else{g.value=e[g.name]}}})}if(/\/query\/?$/i.test(a)){c(b())}else{if(!/(map|feature)server\/\d+\/?$/i.test(a)){alert("Go to the query page to use this tool.")}else{alert("Pick a valid layer")}}}());' title='Query Helper: Give Me All'>Give me all Query Helper</a></li>
				<li><a href='javascript:(function(){var a=window.location.href.split("?")[0];function d(e){return[].map.call(document.getElementsByTagName(e),function(f){return f})}function b(){return d("INPUT").concat(d("TEXTAREA"))}function c(f){var e={where:"1=1",returnCountOnly:"true"};f.forEach(function(g){if(e.hasOwnProperty(g.name)){if(g.type&&g.type==="radio"&&e[g.name]===g.value){g.checked=true}else{g.value=e[g.name]}}})}if(/\/query\/?$/i.test(a)){c(b())}else{if(!/(map|feature)server\/\d+\/?$/i.test(a)){alert("Go to the query page to use this tool.")}else{alert("Pick a valid layer")}}}());' title='Query Helper: Count them up'>Count them Up Query Helper</a></li>
				<li><a href='javascript:(function(){var a=window.location.href.split("?")[0];function d(e){return[].map.call(document.getElementsByTagName(e),function(f){return f})}function b(){return d("INPUT").concat(d("TEXTAREA"))}function c(f){var e={where:"1=1",outFields:"*",returnGeometry:"false"};f.forEach(function(g){if(e.hasOwnProperty(g.name)){if(g.type&&g.type==="radio"&&e[g.name]===g.value){g.checked=true}else{g.value=e[g.name]}}})}if(/\/query\/?$/i.test(a)){c(b())}else{if(!/(map|feature)server\/\d+\/?$/i.test(a)){alert("Go to the query page to use this tool.")}else{alert("Pick a valid layer")}}}());' title='Query Helper: Everything But Geometry'>Everything But Geometry Query Helper</a></li>
			</ul>
		</li>
		<li>
			Miscellaneous:
			<ul>
				<li><a href='javascript:(function(){var l=document,b=l.createElement("form"),h=l.createElement("input"),c=l.createElement("button"),f=l.createElement("ul"),k,g;function m(q,t,r,d){try{d=new (this.XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");d.open(r?"POST":"GET",q,1);d.setRequestHeader("X-Requested-With","XMLHttpRequest");d.setRequestHeader("Content-type","application/x-www-form-urlencoded");d.onreadystatechange=function(){d.readyState>3&&t&&t(JSON.parse(d.responseText),d)};d.send(r)}catch(s){window.console&&console.log(s)}}function i(q,r){var d=r.hasOwnProperty(q[0])?r[q[0]]:null;if(d!=null&&q.length>1){if(d instanceof Array){return d.map(function(s){return i(q.slice(1),s)})}return i(q.slice(1),d)}return d}function e(t,q,r){var d=l.createElement("li"),s=l.createElement("a");s.setAttribute("href",r);s.innerHTML=[r.replace(/^\S*\/rest\/services\//i,""),"=> ",t,": ",q].join("");d.appendChild(s);f.appendChild(d)}function o(s,r,d,q){if(s(d)){g++;e(r,d,q)}}function a(q,r,s){var d=["name","description","displayField","fields.name","fields.alias","mapName","layers.name","documentInfo.Title","documentInfo.Comments","documentInfo.Subject","documentInfo.Category","documentInfo.Keywords","folders","services.name","services.type"];d.forEach(function(u){var t=i(u.split("."),r);if(t==null){return}if(t instanceof Array){t.forEach(function(v){o(s,u,v,q)})}else{o(s,u,t,q)}})}function p(q,u){var t=[],d={folders:function(r){return[q,r].join("/")},services:function(r){return[q,r.name.replace(/\w+\//ig,""),r.type].join("/")},layers:function(r){return[q,r.id].join("/")},tables:function(r){return[q,r.id].join("/")}},s;for(s in d){if(u[s]&&u[s].length){t=t.concat(u[s].map(d[s]))}}return t}function n(q,r){if(!q.length){return}var d=q.shift();m(d+"?f=json",function(t){k++;a(d,t,r);q=q.concat(p(d,t));if(q.length){n(q,r)}else{c.removeAttribute("disabled");c.innerHTML="Search";var s=l.createElement("li");s.innerHTML=["<b>Places Searched:</b>",k,"<br/><b>Results found</b>",g].join(" ");f.insertBefore(s,f.firstChild)}})}function j(){var d,q;if(h.value){while(f.childNodes.length){f.removeChild(f.childNodes[0])}c.innerHTML="Scanning";c.setAttribute("disabled","disabled");if(/^\d*\.?\d+$/.test(h.value)){d=/\./.test(h.value)?parseFloat(h.value):parseInt(h.value,10);q=function(r){return r===d}}else{d=new RegExp(h.value,"i");q=function(r){return d.test(r)}}k=0;g=0;n([window.location.href.replace(window.location.search,"")],q)}else{alert("Please enter a value")}return false}b.setAttribute("style","position:fixed;top:5px;right:5px;width:300px;height:80%;overflow:auto;z-index:100;background:#fff;font-size:0.9em;");h.setAttribute("style","width:75%");b.appendChild(h);c.innerHTML="Search";c.onclick=j;b.appendChild(c);b.appendChild(f);l.body.appendChild(b)}());' title='Rest Search v 0.5'>Rest Search v 0.5</a></li>
				<li><a href='javascript:(function(){var a=window.location.href.split("?")[0],i=document,c=/(execute|submitjob)\/?$/ig;function g(j,m,k,d){try{d=new (window.XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");d.open(k?"POST":"GET",j,1);d.setRequestHeader("X-Requested-With","XMLHttpRequest");d.setRequestHeader("Content-type","application/x-www-form-urlencoded");d.onreadystatechange=function(){d.readyState>3&&m&&m(JSON.parse(d.responseText),d)};d.send(k)}catch(l){window.console&&console.log(l)}}function e(d,k,m){var l=i.createElement(d),j;for(j in k){l.setAttribute(j,k[j])}if(m){l.innerHTML=m}return l}function h(j,d){j.forEach(function(m){if(!m.choiceList){return}console.log("Parameter...",m);var k=e("select",{name:m.name});m.choiceList.forEach(function(n){var o=e("option",{value:n},n);k.appendChild(o)});k.value=m.defaultValue;var l=d.filter(function(n){console.log(n.name);return n.name===m.name})[0];l.parentNode.replaceChild(k,l)})}function b(d){return[].map.call(d,function(j){return j})}function f(j){var l,m=[],d;if(!j.parameters){alert("Could not find GP parameters for this task.");return}try{l=i.getElementsByTagName("FORM")[0];m=b(l.getElementsByTagName("TEXTAREA"));m=m.concat(b(l.getElementsByTagName("INPUT")));h(j.parameters,m);m.some(function(n){if(n.name==="Web_Map_as_JSON"){n.value="{\"operationalLayers\":[],\"baseMap\":{\"baseMapLayers\":[{\"id\":\"defaultBasemap\",\"opacity\":1,\"visibility\":true,\"url\":\"http://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer\"}],\"title\":\"Topographic\"},\"exportOptions\":{\"dpi\":300,\"outputSize\":[1280,1024]}}"}return n.name==="Web_Map_as_JSON"})}catch(k){console.error(k);alert("invalid form")}}if(!c.test(a)){alert("Navigate to valid print task form.")}else{g(a.replace(c,"")+"?f=json",f)}}());' title="Print Task Made Easy BETA">Print Task Made Easy BETA</a></li>
				<li><a href='javascript:(function(){var url="//js.arcgis.com/3.15compact/",css=url+"js/esri/css/esri.css",d=document,style1,scr1;function loadMe(){require(["dojo/ready","dojo/dom-construct","dojo/query","dojo/json","esri/request","esri/toolbars/draw","esri/map","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ArcGISTiledMapServiceLayer"],function(ready,dC,dQ,JSON,esriRequest,Draw,Map,Dynamic,Tiled){ready(function(){var wl=window.location,url=wl.href.replace(wl.search,"").replace(/\/\d+\/query\/?$/i,""),geoBlank=dQ("textarea[name=\"geometry\"]"),geoSelect=dQ("select[name=\"geometryType\"]")[0];esriRequest({url:url,handleAs:"json",content:{f:"json"}}).then(function(resp){var div=dC.create("div",{style:"position:fixed;bottom:15%;top:15%;right:0;width:40%;border:1px solid #F88;padding:5px;background:#fff;overflow:auto;",innerHTML:"<button "+["id=\"btnpt\">Point","id=\"btnln\">Line","id=\"btnpg\">Polygon","id=\"btnex\">Extent"].join("</button><button ")+"</button><button id=\"closr\">Close</button><div id=\"map\" style=\"width:100%;\"></div>"},d.body),map=new Map("map",{}),layer=resp.singleFusedMapCache?new Tiled(url):new Dynamic(url),xlator={btnpt:Draw.POINT,btnln:Draw.POLYLINE,btnpg:Draw.POLYGON,btnex:Draw.EXTENT},draw;map.on("load",function(){draw=new Draw(map);dQ("button",div).on("click",function(evt){if(evt.target.id in xlator){draw.activate(xlator[evt.target.id]);}else{map.destroy();dC.destroy(div);}});draw.on("draw-end",function(drawn){var i,xlator={point:"esriGeometryPoint",multipoint:"esriGeometryMultipoint",polyline:"esriGeometryPolyline",polygon:"esriGeometryPolygon",extent:"esriGeometryEnvelope"};for(i=geoSelect.options.length-1;i>-1;i--){if(geoSelect.options[i].value===xlator[drawn.geometry.type]){geoSelect.selectedIndex=i;break;}}geoBlank.value=JSON.stringify(drawn.geometry.toJson());});});map.addLayer(layer);geoBlank=geoBlank&&geoBlank.length?geoBlank[0]:dC.create("textarea",{},div);});});});}function scriptLoaded(url){var scripts=d.getElementsByTagName("script"),i;for(i=scripts.length-1;i>-1;i--){if(scripts[i].src===url){return true;}}return false;}if(!scriptLoaded(url)){style1=d.createElement("link");style1.setAttribute("rel","stylesheet");style1.setAttribute("type","text/css");style1.href=css;d.head.appendChild(style1);scr1=d.createElement("script");scr1.setAttribute("type","text/javascript");scr1.onload=loadMe;scr1.setAttribute("src",url);d.body.appendChild(scr1);}else{loadMe();}}());' title='Geometry Helper'>Geometry Helper</a></li>
			</ul>
		</li>

	</ul>
</body>
</html>
