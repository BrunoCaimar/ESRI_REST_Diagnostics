<!DOCTYPE HTML>
<html>
<head>
	<title>ESRI REST Diagnoatics</title>
</head>
<body>
	<h1>ESRI Rest Diagnostics</h1>
	<p>This page provides links to tools that can be used to inspect and pull out data out of ArcGIS REST Services.</p>
	<ul>
		<li>
			Map Folder Level:
			<ul>
				<li><a href='javascript:(function(){var d=document,tags=d.getElementsByTagName("a"),urls=[],cH={},i;function getFL(k){var nL="",wl=window.location;if(k.indexOf(wl.protocol)===0){return k;}nL+=wl.protocol+"//";if(k.indexOf(wl.hostname)===0){return nL+k;}nL+=wl.hostname;if(k.indexOf(wl.pathname)===0){return nL+k;}return nL+wl.pathname+k;}function getC(item){if(cH[item]){return cH[item];}cH[item]="#"+(0x1000000+(Math.random())*0xffffff).toString(16).substr(1,6);return cH[item];}function getCC(item){var col=cH[item],newcol="",mid=[col.substr(1,1),col.substr(3,1),col.substr(5,1)].sort()[1],coltbl="fedcba98".indexOf(mid)>-1?"0000000001234567":"89abcdefffffffff",c;for(c=0;c<col.length;c++){newcol+=c%2===1?coltbl[parseInt(col.substr(c,1),16)]:col.substr(c,1);}return newcol;}function srNode(sr){var n,val="&nbsp;No valid spatial reference available &nbsp;",el="span";if(sr){val=sr.latestWkid||sr.wkid||sr.latestWkt||sr.wkt||noval;if(sr.latestWkid||sr.wkid){el="a";}}n=d.createElement(el);if(el==="a"){n.setAttribute("href","http://spatialreference.org/ref/?search="+val);}n.setAttribute("style",["color:",getC(val),";background:",getCC(val),";"].join(""));n.innerHTML=val;return n;}function ajax(u,callback,data,x){try{x=new(this.XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");x.open(data?"POST":"GET",u,1);x.setRequestHeader("X-Requested-With","XMLHttpRequest");x.setRequestHeader("Content-type","application/x-www-form-urlencoded");x.onreadystatechange=function(){x.readyState>3&&callback&&callback(x.responseText,x);};x.send(data);}catch(e){window.console&&console.log(e);}}function queryMe(f){if(!f.length){return;}var data=f.shift();ajax(data.url+"?f=json",function(r){r=JSON.parse(r);var node=srNode(r.spatialReference),n2=d.createElement("b");n2.innerHTML=r.singleFusedMapCache?"tiled":"dynamic";data.link.parentNode.appendChild(node);data.link.parentNode.appendChild(n2);if(f.length){queryMe(f);}});}for(i=0;i<tags.length;i++){if(/(map|feature|image|mobile)server\/?$/i.test(tags[i].href)){urls.push({link:tags[i],url:getFL(tags[i].href)});}}if(urls&&urls.length){queryMe(urls);}else{alert("Pick a REST Service folder with services");}}());' title='Spatial Reference Comparison'>Spatial Reference Comparison</a></li>
				<li><a href='javascript:(function(){var d=document,tags=d.getElementsByTagName("a"),urls=[],i;function ajax(u,callback,data,x){try{x=new(this.XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");x.open(data?"POST":"GET",u,1);x.setRequestHeader("X-Requested-With","XMLHttpRequest");x.setRequestHeader("Content-type","application/x-www-form-urlencoded");x.onreadystatechange=function(){x.readyState>3&&callback&&callback(x.responseText,x);};x.send(data);}catch(e){window.console&&console.log(e);}}function add(nd,t,ct,hF,hC){if(hF&&!ct){return;}var li=d.createElement("li");li.innerHTML=["<b>",t,"</b>",(hC?"":": "+(ct instanceof Object?JSON.stringify(ct):ct))].join("");nd.appendChild(li);}function aSL(nd,t,ct){var li=d.createElement("li"),ul=d.createElement("ul"),i;li.innerHTML="<b>"+t+":</b>";for(i in ct){add(ul,i,ct[i],1);}li.appendChild(ul);nd.appendChild(li);}function queryMe(f){if(!f.length){return;}var data=f.shift();ajax(data.url+"?f=json",function(r){var dF=d.createDocumentFragment(),ul=d.createElement("ul");r=JSON.parse(r);add(dF,"Description",r.description,true);add(dF,"Service Description",r.serviceDescription,true);add(dF,"&copy;",r.copyrightText,true);add(dF,"Supports Dynamic Layers",0,r.supportsDynamicLayers,1);add(dF,"# Layers",r.layers?r.layers.length:0);add(dF,"# Tables",r.tables?r.tables.length:0,1);add(dF,"Tiled or Dynamic",r.tileInfo?" tiled":" dynamic");add(dF,"Spatial Reference",JSON.stringify(r.spatialReference||"none"));add(dF,"Min Scale",r.minScale||"None");add(dF,"Max Scale",r.maxScale||"None");aSL(dF,"Initial Extent",r.initialExtent);aSL(dF,"Full Extent",r.fullExtent);add(dF,"Units",r.units.replace("esri",""));aSL(dF,"Document Info",r.documentInfo);add(dF,"Max Record Count",r.maxRecordCount);tags[data.i].parentNode.appendChild(ul);ul.appendChild(dF);if(f.length){queryMe(f);}});}for(i=0;i<tags.length;i++){if(/(map|feature|image|mobile)server\/?$/i.test(tags[i].href)){urls.push({i:i,url:tags[i].href});}if(urls&&urls.length){queryMe(urls);}}}());' title='MapService Reviewer v 0.3'>MapService Data Extractor v 0.3</a></li>
				<li><a href='javascript:(function(){var h=document,a=window.location.href.replace(window.location.search,""),k=/(map|feature)server\/?$/i.test(a),g=false,b="//js.arcgis.com/3.15compact",f="//js.arcgis.com/3.15/esri/css/esri.css",j,i;function c(d,m){var n=h.createElement(d),l;for(l in m){n.setAttribute(l,m[l])}return n}function e(){var d=c("div",{style:"position:fixed;top:0;right:0;border:1px solid grey;z-index:10;padding:8px;background:#fff;"});d.innerHTML="<div id='map'></div>"+(!k?"<p>Hover over a Map Service link to view it.</p>":"");h.body.appendChild(d);require(["esri/map","esri/request","dojo/query","dojo/domReady!"],function(m,q,o){var p=new m("map");function l(t,s){if(t.layers&&t.layers.length){require(["esri/layers/FeatureLayer","dojo/_base/array"],function(v,u){u.forEach(t.layers,function(x){var w=new v(s.replace(/\/?$/,"/"+x.id),{mode:v.MODE_SNAPSHOT,outFields:["*"]});p.addLayer(w)})})}}function r(t,s){if(t.singleFusedMapCache){require(["esri/layers/ArcGISTiledMapServiceLayer"],function(u){var v=new u(s);p.addLayer(v)})}else{require(["esri/layers/ArcGISDynamicMapServiceLayer"],function(v){var u=new v(s);p.addLayer(u)})}}function n(){if(p.graphicsLayerIds.length+p.layerIds.length>0){p.destroy();p=new m("map")}}if(k){r(a)}else{o("a[href$=MapServer]").on("mouseover",function(s){var t=s.currentTarget.href;n();q({url:t,handleAs:"json",content:{f:"json"}}).then(function(u){r(u,t)},function(u){console.error(u)})});o("a[href$=FeatureServer]").on("mouseover",function(s){var t=s.currentTarget.href;n();q({url:t,handleAs:"json",content:{f:"json"}}).then(function(u){l(u,t)},function(u){console.error(u)})})}})}g=[].some.call(h.getElementsByTagName("script"),function(d){return d.src===b});if(g){e()}else{j=c("link",{rel:"stylesheet",type:"text/css",href:f});h.head.appendChild(j);i=c("script",{type:"text/javascript"});i.onload=e;i.setAttribute("src",b);h.body.appendChild(i)}}());' title='Map Viewer v. 0.3'>Map Viewer v. 0.3</a></li>
			</ul>
		</li>
		<li>
			Map Service Level:
			<ul>
				<li><a href='javascript:(function(){var d=document,tags=d.getElementsByTagName("a"),urls=[],i;function ajax(u,callback,data,x){try{x=new(this.XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");x.open(data?"POST":"GET",u,1);x.setRequestHeader("X-Requested-With","XMLHttpRequest");x.setRequestHeader("Content-type","application/x-www-form-urlencoded");x.onreadystatechange=function(){x.readyState>3&&callback&&callback(x.responseText,x);};x.send(data);}catch(e){window.console&&console.log(e);}}function add(frag,t,c){var li=d.createElement("li");li.innerHTML=["<b>",t,"</b>",c?": ":"",c].join("");frag.appendChild(li);}function queryMe(f){if(!f.length){return;}var data=f.shift();ajax(data.url+"?f=json",function(r){var dF=d.createDocumentFragment(),ul=d.createElement("ul");r=JSON.parse(r);add(dF,"Geometry",r.geometryType.replace("esriGeometry",""));add(dF,"Min Scale",r.minScale||"None");add(dF,"Max Scale",r.maxScale||"None");if(r.definitionExpression){add(dF,"Definition Expression",r.definitionExpression);}add(dF,"Visible by default",r.defaultVisibility.toString());if(r.hasAttachments){add(dF,"Has Attachments");}if(r.hasLabels){add(dF,"Has Labels");}if(r.supportsStatistics){add(dF,"Supports Statistics");}if(r.supportsAdvancedQueries){add(dF,"Supports Advanced Queries");}if(r.relationships&&r.relationships.length){add(dF,"Has Relationships");}add(dF,"Versioned Data",r.isDataVersioned?"Yes":"No");tags[data.i].parentNode.appendChild(ul);ul.appendChild(dF);if(f.length){queryMe(f);}});}if(/(map|feature)server\/?$/i.test(window.location.href)){for(i=0;i<tags.length;i++){if(/server\/\d+\/?$/i.test(tags[i].href)){urls.push({i:i,url:tags[i].href});}if(urls&&urls.length){queryMe(urls);}}}else{if(/server\/\d+\/?$/i.test(window.location.href)){alert("Go to the parent map service layer.");}else{alert("Pick a valid layer");}}}());' title='Layer Property Extractor'>Layer Property Extractor v. 0.1</a></li>
				<li><a href='javascript:(function(){var d=document,tags=d.getElementsByTagName("a"),urls=[],i;function ajax(u,callback,data,x){try{x=new(this.XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");x.open(data?"POST":"GET",u,1);x.setRequestHeader("X-Requested-With","XMLHttpRequest");x.setRequestHeader("Content-type","application/x-www-form-urlencoded");x.onreadystatechange=function(){x.readyState>3&&callback&&callback(JSON.parse(x.responseText),x);};x.send(data);}catch(e){window.console&&console.log(e);}}function add(frag,t,ct){var li=d.createElement("li");li.innerHTML=["<b>",t,"</b>",ct!=null?": ":"",ct].join("");frag.appendChild(li);}function queryMe(f){if(!f.length){return;}var data=f.shift();ajax(data.url+"?f=json",function(r){var ul=d.createElement("ul"),oid=null,shape=null,newURL=data.url+"/query?where=not+field+is+null&returnGeometry=false&returnCountOnly=true&f=json",j;if(r.fields){for(j=0;j<r.fields.length;j++){switch(r.fields[j].type){case"esriFieldTypeOID":case"":oid=r.fields[j].name;break;case"esriFieldTypeGeometry":shape=r.fields[j].name;break;}if(oid&&shape){break;}}}if(oid){ajax(newURL.replace("field",oid),function(cnt){add(ul,"Number of Results",cnt.count);});}if(shape){ajax(newURL.replace("field",shape),function(cnt){add(ul,"With geometry",cnt.count);});}if(r.fields&&!oid&&!shape){add(ul,"No Queryable Results");}tags[data.i].parentNode.appendChild(ul);if(f.length){queryMe(f);}});}if(/(map|feature)server\/?$/i.test(window.location.href)){for(i=0;i<tags.length;i++){if(/server\/\d+\/?$/i.test(tags[i].href)){urls.push({i:i,url:tags[i].href});}}if(urls&&urls.length){queryMe(urls);}}else{if(/server\/\d+\/?$/i.test(window.location.href)){alert("Go to the parent map service layer.");}else{alert("Pick a valid layer");}}}());' title='Layer Feature Counter'>Layer Feature Counter v. 0.1</a></li>
				<li><a href='javascript:(function(){var d=document,tags=d.getElementsByTagName("a"),urls=[],i;function iA(n,r){r.parentNode.insertBefore(n,r.nextSibling);}function Result(m,c){var k=d.createElement("span");k.innerHTML=m;k.setAttribute("style","font-weight:bold;color:"+c+";");return k;}function oS(index){iA(Result(" OK ","green"),tags[index]);this.parentNode.removeChild(this);}function oE(index,error){iA(Result(" !!! ","red"),tags[index]);console.error(error);this.parentNode.removeChild(this);}function queryMe(f){if(!f.length){return;}var data=f.shift(),img=d.createElement("img");img.onerror=function(err){oE.call(this,data.i,err);};img.onload=function(){oS.call(this,data.i);};img.setAttribute("src",data.url);iA(img,tags[data.i]);setTimeout(function(){queryMe(f);},50);}if(/(map|feature)server\/?$/i.test(window.location.href)){for(i=0;i<tags.length;i++){if(/server\/tile\/\d+\/\d+\/\d+\/?$/i.test(tags[i].href)){urls.push({i:i,url:tags[i].href});}}if(urls&&urls.length){queryMe(urls);}}else{if(/server\/\d+\/?$/i.test(window.location.href)){alert("Go to the parent map service layer.");}else{alert("Pick a valid layer");}}}());' title='Tiled Service Tester'>Tiled Service Tester v. 0.1</a></li>
				<li><a href='javascript:(function(){var h=document,a=window.location.href.replace(window.location.search,""),k=/(map|feature)server\/?$/i.test(a),g=false,b="//js.arcgis.com/3.15compact",f="//js.arcgis.com/3.15/esri/css/esri.css",j,i;function c(d,m){var n=h.createElement(d),l;for(l in m){n.setAttribute(l,m[l])}return n}function e(){var d=c("div",{style:"position:fixed;top:0;right:0;border:1px solid grey;z-index:10;padding:8px;background:#fff;"});d.innerHTML="<div id='map'></div>"+(!k?"<p>Hover over a Map Service link to view it.</p>":"");h.body.appendChild(d);require(["esri/map","esri/request","dojo/query","dojo/domReady!"],function(m,q,o){var p=new m("map");function l(t,s){if(t.layers&&t.layers.length){require(["esri/layers/FeatureLayer","dojo/_base/array"],function(v,u){u.forEach(t.layers,function(x){var w=new v(s.replace(/\/?$/,"/"+x.id),{mode:v.MODE_SNAPSHOT,outFields:["*"]});p.addLayer(w)})})}}function r(t,s){if(t.singleFusedMapCache){require(["esri/layers/ArcGISTiledMapServiceLayer"],function(u){var v=new u(s);p.addLayer(v)})}else{require(["esri/layers/ArcGISDynamicMapServiceLayer"],function(v){var u=new v(s);p.addLayer(u)})}}function n(){if(p.graphicsLayerIds.length+p.layerIds.length>0){p.destroy();p=new m("map")}}if(k){r(a)}else{o("a[href$=MapServer]").on("mouseover",function(s){var t=s.currentTarget.href;n();q({url:t,handleAs:"json",content:{f:"json"}}).then(function(u){r(u,t)},function(u){console.error(u)})});o("a[href$=FeatureServer]").on("mouseover",function(s){var t=s.currentTarget.href;n();q({url:t,handleAs:"json",content:{f:"json"}}).then(function(u){l(u,t)},function(u){console.error(u)})})}})}g=[].some.call(h.getElementsByTagName("script"),function(d){return d.src===b});if(g){e()}else{j=c("link",{rel:"stylesheet",type:"text/css",href:f});h.head.appendChild(j);i=c("script",{type:"text/javascript"});i.onload=e;i.setAttribute("src",b);h.body.appendChild(i)}}());' title='Map Viewer v. 0.3'>Map Viewer v. 0.3</a></li>
			</ul>
		</li>
		<li>
			Map Layer Level:
			<ul>
				<li><a href='javascript:(function(){var url=window.location.href,d=document;function ajax(u,callback,data,x){try{x=new(this.XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");x.open(data?"POST":"GET",u,1);x.setRequestHeader("X-Requested-With","XMLHttpRequest");x.setRequestHeader("Content-type","application/x-www-form-urlencoded");x.onreadystatechange=function(){x.readyState>3&&callback&&callback(x.responseText,x);};x.send(data);}catch(e){window.console&&console.log(e);}}function responseTime(timeValue){var timeDiff=Date.now()-timeValue;return""+(timeDiff>1000?timeDiff/1000:timeDiff+"m")+"s";}function queryMe(f,nodes){if(!f.length){return;}var field=f.shift(),node=nodes.shift(),params="/query?where=not+field+is+null&returnGeometry=false&returnCountOnly=true&f=json".replace("field",field.name),timeCheck=Date.now();ajax(url+params,function(response){response=JSON.parse(response);var tr=d.createElement("ul");tr.innerHTML="<li>"+["<b>Features with values: </b>"+response.count+(!response.count?"<b style=\"color:#f00;\"> !!!</b>":""),"<b>Response Time: </b>"+responseTime(timeCheck)].join("</li><li>")+"</li>";node.appendChild(tr);if(f.length){queryMe(f,nodes);}});}function getFieldList(){var uls=d.getElementsByTagName("ul"),labels=[].map.call(uls,function(node){var h=node;while(h.previousSibling){h=h.previousSibling;if(h.tagName==="B")break;}return h.innerHTML;}),i;for(i=uls.length-1;i>-1;i--){if(/^Fields\:/.test(labels[i])){return[].map.call(uls[i].children,function(j){return j;});}}return null;}function onLoad(response){response=JSON.parse(response);if(response.fields){queryMe(response.fields,getFieldList());}}if(/\d+\/?$/.test(url)){ajax(url+"?f=json",onLoad);}else{if(!/(map|feature)server\/?$/i.test(url)){alert("Pick a map/feature service and layer");}else{alert("Pick a valid layer");}}}());' title='Populated Field Tester (null only)'>Field Value Tester (null test only) v. 0.4</a></li>
				<li><a href='javascript:(function(){var url=window.location.href,d=document;function ajax(u,callback,data,x){try{x=new(this.XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");x.open(data?"POST":"GET",u,1);x.setRequestHeader("X-Requested-With","XMLHttpRequest");x.setRequestHeader("Content-type","application/x-www-form-urlencoded");x.onreadystatechange=function(){x.readyState>3&&callback&&callback(x.responseText,x);};x.send(data)}catch(e){window.console&&console.log(e);}}function responseTime(timeValue){var timeDiff=Date.now()-timeValue;return""+(timeDiff>1000?timeDiff/1000:timeDiff+"m")+"s";}function queryMe(f,nodes){if(!f.length){return;}var field=f.shift(),node=nodes.shift(),params="/query?where=not+field+is+null+and+field+<>%27%27&returnGeometry=false&returnCountOnly=true&f=json".replace(/field/g,field.name),timeCheck=Date.now();ajax(url+params,function(response){response=JSON.parse(response);var tr=d.createElement("ul");tr.innerHTML="<li>"+["<b>Features with values: </b>"+response.count+(!response.count?"<b style=\"color:#f00;\"> !!!</b>":""),"<b>Response Time: </b>"+responseTime(timeCheck)].join("</li><li>")+"</li>";node.appendChild(tr);if(f.length){queryMe(f,nodes);}});}function getFieldList(){var uls=d.getElementsByTagName("ul"),labels=[].map.call(uls,function(node){var h=node;while(h.previousSibling){h=h.previousSibling;if(h.tagName==="B")break;}return h.innerHTML;}),i;for(i=uls.length-1;i>-1;i--){if(labels[i]==="Fields: "){return[].map.call(uls[i].children,function(j){return j;});}}return null;}function onLoad(response){response=JSON.parse(response);if(response.fields){queryMe(response.fields,getFieldList());}}if(/\d+\/?$/.test(url)){ajax(url+"?f=json",onLoad);}else{if(!/(map|feature)server\/?$/i.test(url)){alert("Pick a map/feature service and layer");}else{alert("Pick a valid layer");}}}());' title='Populated Field Tester (null and empty string)'>Populated Field Value Tester (null or empty string) v. 0.5</a></li>
				<li><a href='javascript:(function(){var url=window.location.href,d=document;function ajax(u,callback,data,x){try{x=new(this.XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");x.open(data?"POST":"GET",u,1);x.setRequestHeader("X-Requested-With","XMLHttpRequest");x.setRequestHeader("Content-type","application/x-www-form-urlencoded");x.onreadystatechange=function(){x.readyState>3&&callback&&callback(x.responseText,x);};x.send(data);}catch(e){window.console&&console.log(e);}}function queryMe(f,ns,tr){if(!f.length){return;}if(!tr){var n=ns.shift();tr=d.createElement("ul");n.appendChild(tr);}if(f[0].length){var im=f[0].shift(),value=im.type==="esriFieldTypeString"?"%27"+im.code+"%27":im.code,params="/query?where=field+%3D+value&returnGeometry=false&returnCountOnly=true&f=json".replace("field",im.field).replace("value",value);ajax(url+params,function(rs){rs=JSON.parse(rs);var li=d.createElement("li");li.innerHTML=["<b>",im.name,": </b>",rs.count,(!rs.count?"<b style=\"color:#f00;\"> !!!</b>":"")].join("");tr.appendChild(li);if(f[0].length){queryMe(f,ns,tr);}else{f.shift();if(f.length){queryMe(f,ns);}}});}}function getFieldList(){var uls=d.getElementsByTagName("ul"),ls=[].map.call(uls,function(n){var h=n;while(h.previousSibling){h=h.previousSibling;if(h.tagName==="B")break;}return h.innerHTML;}),i;for(i=uls.length-1;i>-1;i--){if(ls[i]==="Fields: "){return[].map.call(uls[i].children,function(j){return j;});}}return null;}function onLoad(rs){var fn,fd,fs=[],i;rs=JSON.parse(rs);if(rs.fields){fn=getFieldList();for(i=rs.fields.length-1;i>-1;i--){fd=rs.fields[i];if(fd.domain){if(fd.domain.codedValues){fs.push(fd.domain.codedValues.map(function(im){im.field=fd.name;im.type=fd.type;return im;}));}else if(fd.domain.range){}}else{fn.splice(i,1);}}fs.reverse();queryMe(fs,fn,null);}}if(/\d+\/?$/.test(url)){ajax(url+"?f=json",onLoad);}else{if(!/(map|feature)server\/?$/i.test(url)){alert("Pick a map/feature service and layer");}else{alert("Pick a valid layer");}}}());' title='Domain Data Counter'>Domain Data Counter v. 0.1</a></li>
			</ul>
		</li>
		<li>
			Map Layer Query Level:
			<ul>
				<li><a href='javascript:(function(){var d=document,wl=window.location,url=wl.href.replace(wl.search,""),qreg=/\/query\/?$/i,ac;function ajax(u,cb,data,x){try{x=new(this.XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");x.open(data?"POST":"GET",u,1);x.setRequestHeader("X-Requested-With","XMLHttpRequest");x.setRequestHeader("Content-type","application/x-www-form-urlencoded");x.onreadystatechange=function(){x.readyState>3&&cb&&cb(JSON.parse(x.responseText),x);};x.send(data);}catch(e){window.console&&console.log(e);}}function listenAll(n,s,evt,cb){[].forEach.call(n.querySelectorAll(s),function(el){el[evt]=cb;});}function build(fs){var div=d.createElement("div"),listF=d.createElement("select"),listR=d.createElement("select"),btns=d.createElement("div");div.setAttribute("style","position:fixed;top:10%;right:0;width:35%;padding:5px;background:#fff;overflow:auto;");div.innerHTML="<button style=\"float:right;\" onclick=\"this.parentNode.parentNode.removeChild(this.parentNode);\">Close</button><b>Query Builder</b><br />";d.body.appendChild(div);listF.setAttribute("size","10");listF.innerHTML=fs.map(function(field){return["<option value=\"",field.name,"\">",field.alias,"</option>"].join("");}).join("");div.appendChild(listF);listR.setAttribute("size","10");div.appendChild(listR);listF.onchange=function(){var val=listF.value;ajax(url+"?where=field+like+%27%25%27&returnGeometry=false&outFields=field&orderByFields=field&returnDistinctValues=true&f=json".replace(/field/g,val),function(res){listR.innerHTML=[].map.call(res.features,function(fr){var i=fr.attributes[val];return["<option value=\"",i,"\">",i,"</option>"].join("");});});};btns.innerHTML=[" = "," &lt;&gt; "," LIKE "," &gt; "," &gt;= "," AND "," &lt; "," &lt;= "," OR ","_","%","()","NOT "," IS ","*","&#39;&#39;"," IN ",", "].map(function(txt){return["<button class=\"sql\" type=\"button\" name=\"",txt,"\">",txt.replace(/\s+/g,""),"</button>"].join("");});div.appendChild(btns);return div;}function setActive(value){var oldVal=ac.value.substring(0),iC=oldVal.length;ac.focus();if(d.selection){var oSel=d.selection.createRange();oSel.moveStart("character",-ac.value.length);iC=oSel.text.length;}else if("selectionStart"in ac){iC=ac.selectionStart;}ac.value=oldVal.substring(0,iC)+value+oldVal.substring(iC);iC+=value.length-(["()",decodeURIComponent("%27%27")].indexOf(value)>-1);if(ac.createTextRange){var range=ac.createTextRange();range.move("character",iC);range.select();}else if("selectionStart"in ac){ac.setSelectionRange(iC,iC);}}function onLoad(r){var n=build(r.fields);listenAll(n,"select","onclick",function(evt){setActive(evt.currentTarget.value);});listenAll(n,"button.sql","onclick",function(evt){setActive(evt.currentTarget.name);});}listenAll(d,"input[type=text], textarea","onblur",function(){ac=this;});if(qreg.test(url)){ajax(url.replace(qreg,"")+"?f=json",onLoad);}else{if(!/(map|feature)server\/\d+\/?$/i.test(url)){alert("Go to the query page to use this tool.");}else{alert("Pick a valid layer");}}}());' title='Select By Attributes Query Helper'>Select By Attributes Query Helper v. 0.1</a></li>
			</ul>
		</li>
		<li><a href='javascript:(function(){var d=document,form=d.createElement("form"),txt=d.createElement("input"),btn=d.createElement("button"),rL=d.createElement("ul"),locs,hits;function ajax(u,callback,data,x){try{x=new(this.XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");x.open(data?"POST":"GET",u,1);x.setRequestHeader("X-Requested-With","XMLHttpRequest");x.setRequestHeader("Content-type","application/x-www-form-urlencoded");x.onreadystatechange=function(){x.readyState>3&&callback&&callback(JSON.parse(x.responseText),x);};x.send(data);}catch(e){window.console&&console.log(e);}}function gFV(fs,dt){var rs=dt.hasOwnProperty(fs[0])?dt[fs[0]]:null;if(rs!=null&&fs.length>1){if(rs instanceof Array){return rs.map(function(item){return gFV(fs.slice(1),item);});}return gFV(fs.slice(1),rs);}return rs;}function pR(f,rs,url){var li=d.createElement("li"),link=d.createElement("a");link.setAttribute("href",url);link.innerHTML=[url.replace(/^\S*\/rest\/services\//i,""),"=> ",f,": ",rs].join("");li.appendChild(link);rL.appendChild(li);}function cAP(mT,f,rs,url){if(mT(rs)){hits++;pR(f,rs,url);}}function rSc(url,dt,mT){var fL=["name","description","displayField","fields.name","fields.alias","mapName","layers.name","documentInfo.Title","documentInfo.Comments","documentInfo.Subject","documentInfo.Category","documentInfo.Keywords","folders","services.name","services.type"];fL.forEach(function(f){var rs=gFV(f.split("."),dt);if(rs==null){return;}if(rs instanceof Array){rs.forEach(function(item){cAP(mT,f,item,url);});}else{cAP(mT,f,rs,url);}});}function sUs(url,dt){var ls=[],runners={"folders":function(fd){return[url,fd].join("/");},"services":function(sc){return[url,sc.name.replace(/\w+\//ig,""),sc.type].join("/");},"layers":function(layer){return[url,layer.id].join("/");},"tables":function(table){return[url,table.id].join("/");}},r;for(r in runners){if(dt[r]&&dt[r].length){ls=ls.concat(dt[r].map(runners[r]));}}return ls;}function queryMe(ls,mT){if(!ls.length){return;}var url=ls.shift();ajax(url+"?f=json",function(dt){locs++;rSc(url,dt,mT);ls=ls.concat(sUs(url,dt));if(ls.length){queryMe(ls,mT);}else{btn.removeAttribute("disabled");btn.innerHTML="Search";var li=d.createElement("li");rL.insertBefore(li,rL.firstChild);li.innerHTML=["<b>Places Searched:</b>",locs,"<br/><b>Results found</b>",hits].join(" ");}});}function oSt(){var sF,mT;if(txt.value){while(rL.childNodes.length){rL.removeChild(rL.childNodes[0]);}btn.innerHTML="Scanning";btn.setAttribute("disabled","disabled");if(/^\d*\.?\d+$/.test(txt.value)){sF=/\./.test(txt.value)?parseFloat(txt.value):parseInt(txt.value,10);mT=function(val){return val===sF;};}else{sF=new RegExp(txt.value,"i");mT=function(val){return sF.test(val);};}locs=0;hits=0;queryMe([location.href.replace(location.search,"")],mT);}else{alert("Please enter a value");}return false;}form.setAttribute("style","position:fixed;top:5px;right:5px;width:300px;height:80%;overflow:auto;z-index:100;background:#fff;font-size:0.9em;");txt.setAttribute("style","width:75%");form.appendChild(txt);btn.innerHTML="Search";btn.onclick=oSt;form.appendChild(btn);form.appendChild(rL);d.body.appendChild(form);}());' title='Rest Search v 0.3'>Rest Search v 0.3</a></li>
		<li><a href='javascript:(function(){var url="http://js.arcgis.com/3.10/",css=url+"js/esri/css/esri.css",d=document,style1,scr1;function loadMe(){require(["dojo/ready","dojo/dom-construct","dojo/query","dojo/json","esri/request","esri/toolbars/draw","esri/map","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ArcGISTiledMapServiceLayer"],function(ready,dC,dQ,JSON,esriRequest,Draw,Map,Dynamic,Tiled){ready(function(){var wl=window.location,url=wl.href.replace(wl.search,"").replace(/\/\d+\/query\/?$/i,""),geoBlank=dQ("textarea[name=\"geometry\"]"),geoSelect=dQ("select[name=\"geometryType\"]")[0];esriRequest({url:url,handleAs:"json",content:{f:"json"}}).then(function(resp){var div=dC.create("div",{style:"position:fixed;bottom:15%;top:15%;right:0;width:40%;border:1px solid #F88;padding:5px;background:#fff;overflow:auto;",innerHTML:"<button "+["id=\"btnpt\">Point","id=\"btnln\">Line","id=\"btnpg\">Polygon","id=\"btnex\">Extent"].join("</button><button ")+"</button><button id=\"closr\">Close</button><div id=\"map\" style=\"width:100%;\"></div>"},d.body),map=new Map("map",{}),layer=resp.singleFusedMapCache?new Tiled(url):new Dynamic(url),xlator={btnpt:Draw.POINT,btnln:Draw.POLYLINE,btnpg:Draw.POLYGON,btnex:Draw.EXTENT},draw;map.on("load",function(){draw=new Draw(map);dQ("button",div).on("click",function(evt){if(evt.target.id in xlator){draw.activate(xlator[evt.target.id]);}else{map.destroy();dC.destroy(div);}});draw.on("draw-end",function(drawn){var i,xlator={point:"esriGeometryPoint",multipoint:"esriGeometryMultipoint",polyline:"esriGeometryPolyline",polygon:"esriGeometryPolygon",extent:"esriGeometryEnvelope"};for(i=geoSelect.options.length-1;i>-1;i--){if(geoSelect.options[i].value===xlator[drawn.geometry.type]){geoSelect.selectedIndex=i;break;}}geoBlank.value=JSON.stringify(drawn.geometry.toJson());});});map.addLayer(layer);geoBlank=geoBlank&&geoBlank.length?geoBlank[0]:dC.create("textarea",{},div);});});});}function scriptLoaded(url){var scripts=d.getElementsByTagName("script"),i;for(i=scripts.length-1;i>-1;i--){if(scripts[i].src===url){return true;}}return false;}if(!scriptLoaded(url)){style1=d.createElement("link");style1.setAttribute("rel","stylesheet");style1.setAttribute("type","text/css");style1.href=css;d.head.appendChild(style1);scr1=d.createElement("script");scr1.setAttribute("type","text/javascript");scr1.onload=loadMe;scr1.setAttribute("src",url);d.body.appendChild(scr1);}else{loadMe();}}());' title='Geometry Helper'>Geometry Helper</a></li>
	</ul>
</body>
</html>
