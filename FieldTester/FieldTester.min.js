(function(){var url=window.location.href,d=document,node;function ajax(u,callback,data,x){try{x=new(this.XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");x.open(data?"POST":"GET",u,1);x.setRequestHeader("X-Requested-With","XMLHttpRequest");x.setRequestHeader("Content-type","application/x-www-form-urlencoded");x.onreadystatechange=function(){x.readyState>3&&callback&&callback(x.responseText,x);};x.send(data)}catch(e){window.console&&console.log(e);}}function queryMe(fs){if(!fs.length){return;}var f=fs.shift(),p="/query?where=not+field+is+null&returnGeometry=false&returnCountOnly=true&f=json".replace("field",f.name),tc=Date.now();ajax(url+p,function(r){r=JSON.parse(r);var tr=d.createElement("tr");tr.innerHTML="<td>"+[f.name,f.alias,f.type,r.count,Date.now()-tc].join("</td><td>")+"</td>";node.appendChild(tr);if(fs.length){queryMe(fs);}});}function onLoad(r){r=JSON.parse(r);if(r.fields){var div=d.createElement("div");div.setAttribute("style","position:fixed;bottom:5px;top:50%;right:5px;width:50%;border:1px solid #0F0;padding:5px;background:#fff;overflow:auto;text-align:center;");d.body.appendChild(div);var cb=d.createElement("button");cb.setAttribute("type","button");cb.setAttribute("style","float:right;");cb.onclick=function(){d.body.removeChild(div)};cb.innerHTML="close";div.appendChild(cb);var table=d.createElement("table");table.setAttribute("style","position:relative;margin:0 auto;");table.innerHTML="<thead><tr><th>"+["Field Name","Alias","Type","# values not null","Return Time (ms)"].join("</th><th>")+"</th></tr></thead>";div.appendChild(table);node=d.createElement("tbody");table.appendChild(node);queryMe(r.fields);}}if(/\d+\/?$/.test(url)){ajax(url+"?f=json",onLoad);}else{if(!/(map|feature)server\/?$/i.test(url)){alert("Pick a map/feature service and layer");}else{alert("Pick a valid layer");}}}());