(function(){var l=document,b=l.createElement("form"),h=l.createElement("input"),c=l.createElement("button"),f=l.createElement("ul"),k,g;function m(q,t,r,d){try{d=new (this.XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");d.open(r?"POST":"GET",q,1);d.setRequestHeader("X-Requested-With","XMLHttpRequest");d.setRequestHeader("Content-type","application/x-www-form-urlencoded");d.onreadystatechange=function(){d.readyState>3&&t&&t(JSON.parse(d.responseText),d)};d.send(r)}catch(s){window.console&&console.log(s)}}function i(q,r){var d=r.hasOwnProperty(q[0])?r[q[0]]:null;if(d!=null&&q.length>1){if(d instanceof Array){return d.map(function(s){return i(q.slice(1),s)})}return i(q.slice(1),d)}return d}function e(t,q,r){var d=l.createElement("li"),s=l.createElement("a");s.setAttribute("href",r);s.innerHTML=[r.replace(/^\S*\/rest\/services\//i,""),"=> ",t,": ",q].join("");d.appendChild(s);f.appendChild(d)}function o(s,r,d,q){if(s(d)){g++;e(r,d,q)}}function a(q,r,s){var d=["name","description","displayField","fields.name","fields.alias","mapName","layers.name","documentInfo.Title","documentInfo.Comments","documentInfo.Subject","documentInfo.Category","documentInfo.Keywords","folders","services.name","services.type"];d.forEach(function(u){var t=i(u.split("."),r);if(t==null){return}if(t instanceof Array){t.forEach(function(v){o(s,u,v,q)})}else{o(s,u,t,q)}})}function p(q,u){var t=[],d={folders:function(r){return[q,r].join("/")},services:function(r){return[q,r.name.replace(/\w+\//ig,""),r.type].join("/")},layers:function(r){return[q,r.id].join("/")},tables:function(r){return[q,r.id].join("/")}},s;for(s in d){if(u[s]&&u[s].length){t=t.concat(u[s].map(d[s]))}}return t}function n(q,r){if(!q.length){return}var d=q.shift();m(d+"?f=json",function(t){k++;a(d,t,r);q=q.concat(p(d,t));if(q.length){n(q,r)}else{c.removeAttribute("disabled");c.innerHTML="Search";var s=l.createElement("li");s.innerHTML=["<b>Places Searched:</b>",k,"<br/><b>Results found</b>",g].join(" ");f.insertBefore(s,f.firstChild)}})}function j(){var d,q;if(h.value){while(f.childNodes.length){f.removeChild(f.childNodes[0])}c.innerHTML="Scanning";c.setAttribute("disabled","disabled");if(/^\d*\.?\d+$/.test(h.value)){d=/\./.test(h.value)?parseFloat(h.value):parseInt(h.value,10);q=function(r){return r===d}}else{d=new RegExp(h.value,"i");q=function(r){return d.test(r)}}k=0;g=0;n([window.location.href.replace(window.location.search,"")],q)}else{alert("Please enter a value")}return false}b.setAttribute("style","position:fixed;top:5px;right:5px;width:300px;height:80%;overflow:auto;z-index:100;background:#fff;font-size:0.9em;");h.setAttribute("style","width:75%");b.appendChild(h);c.innerHTML="Search";c.onclick=j;b.appendChild(c);b.appendChild(f);l.body.appendChild(b)}());