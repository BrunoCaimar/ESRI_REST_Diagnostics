(function(){var d=document,tags=d.getElementsByTagName("a"),urls=[],cH={},i;function getFL(k){var nL="",wl=window.location;if(k.indexOf(wl.protocol)===0){return k;}nL+=wl.protocol+"//";if(k.indexOf(wl.hostname)===0){return nL+k;}nL+=wl.hostname;if(k.indexOf(wl.pathname)===0){return nL+k;}return nL+wl.pathname+k;}function getC(item){if(cH[item]){return cH[item];}cH[item]="#"+(0x1000000+(Math.random())*0xffffff).toString(16).substr(1,6);return cH[item];}function getCC(item){var col=cH[item],newcol="",mid=[col.substr(1,1),col.substr(3,1),col.substr(5,1)].sort()[1],coltbl="fedcba98".indexOf(mid)>-1?"0000000001234567":"89abcdefffffffff",c;for(c=0;c<col.length;c++){newcol+=c%2===1?coltbl[parseInt(col.substr(c,1),16)]:col.substr(c,1);}return newcol;}function srNode(sr){var n,val="&nbsp;No valid spatial reference available &nbsp;",el="span";if(sr){val=sr.latestWkid||sr.wkid||sr.latestWkt||sr.wkt||noval;if(sr.latestWkid||sr.wkid){el="a";}}n=d.createElement(el);if(el==="a"){n.setAttribute("href","http://spatialreference.org/ref/?search="+val);}n.setAttribute("style",["color:",getC(val),";background:",getCC(val),";"].join(""));n.innerHTML=val;return n;}function ajax(u,callback,data,x){try{x=new(this.XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");x.open(data?"POST":"GET",u,1);x.setRequestHeader("X-Requested-With","XMLHttpRequest");x.setRequestHeader("Content-type","application/x-www-form-urlencoded");x.onreadystatechange=function(){x.readyState>3&&callback&&callback(x.responseText,x);};x.send(data);}catch(e){window.console&&console.log(e);}}function queryMe(f){if(!f.length){return;}var data=f.shift();ajax(data.url+"?f=json",function(r){r=JSON.parse(r);var node=srNode(r.spatialReference),n2=d.createElement("b");n2.innerHTML=r.singleFusedMapCache?"tiled":"dynamic";data.link.parentNode.appendChild(node);data.link.parentNode.appendChild(n2);if(f.length){queryMe(f);}});}for(i=0;i<tags.length;i++){if(/(map|feature|image|mobile)server\/?$/i.test(tags[i].href)){urls.push({link:tags[i],url:getFL(tags[i].href)});}}if(urls&&urls.length){queryMe(urls);}else{alert("Pick a REST Service folder with services");}}());